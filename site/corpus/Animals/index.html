
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="An intuitive, fast-paced introduction to Retrieval Augmented Generation (RAG)" name="description"/>
<meta content="SupportVectors" name="author"/>
<link href="https://supportvectors.ai/rag-to-riches/corpus/Animals/" rel="canonical"/>
<link href="../AnimalWisdom/" rel="prev"/>
<link href="../../examples/" rel="next"/>
<link href="../../images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Animals Class: Complete RAG System - SupportVectors Rag to Riches</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Lora:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Lora";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../stylesheets/supportvectors.css" rel="stylesheet"/>
<link href="../../css/ansi-colours.css" rel="stylesheet"/>
<link href="../../css/jupyter-cells.css" rel="stylesheet"/>
<link href="../../css/pandas-dataframe.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="gray" data-md-color-primary="light-blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#animals-class-complete-rag-system">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="SupportVectors Rag to Riches" class="md-header__button md-logo" data-md-component="logo" href="../.." title="SupportVectors Rag to Riches">
<img alt="logo" src="../../images/overlapping_logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            SupportVectors Rag to Riches
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Animals Class: Complete RAG System
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="gray" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="SupportVectors Rag to Riches" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="SupportVectors Rag to Riches">
<img alt="logo" src="../../images/overlapping_logo.png"/>
</a>
    SupportVectors Rag to Riches
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    RAG to Riches: Advanced Retrieval-Augmented Generation Framework
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Corpus
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Corpus
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Corpus Package: Data Models and Content Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AnimalQuote/">
<span class="md-ellipsis">
    AnimalQuote Class: Individual Quote Data Model
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AnimalWisdom/">
<span class="md-ellipsis">
    AnimalWisdom Class: Quote Collection Management
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Animals Class: Complete RAG System
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Animals Class: Complete RAG System
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-overview">
<span class="md-ellipsis">
      🎯 Class Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-definition">
<span class="md-ellipsis">
      📋 Class Definition
    </span>
</a>
<nav aria-label="📋 Class Definition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-architecture">
<span class="md-ellipsis">
      🏗️ Class Architecture
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-features">
<span class="md-ellipsis">
      🚀 Key Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constructor">
<span class="md-ellipsis">
      📖 Constructor
    </span>
</a>
<nav aria-label="📖 Constructor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#__init__vector_db-embeddernone-collection_nameanimals">
<span class="md-ellipsis">
      __init__(vector_db, embedder=None, collection_name="animals")
    </span>
</a>
<nav aria-label='__init__(vector_db, embedder=None, collection_name="animals")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-by-contract">
<span class="md-ellipsis">
      Design by Contract
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-loading-methods">
<span class="md-ellipsis">
      📥 Data Loading Methods
    </span>
</a>
<nav aria-label="📥 Data Loading Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#load_from_jsonljsonl_path">
<span class="md-ellipsis">
      load_from_jsonl(jsonl_path)
    </span>
</a>
<nav aria-label="load_from_jsonl(jsonl_path)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_1">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#expected-jsonl-format">
<span class="md-ellipsis">
      Expected JSONL Format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_1">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#index_all_quotes">
<span class="md-ellipsis">
      index_all_quotes()
    </span>
</a>
<nav aria-label="index_all_quotes()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_1">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#process-flow">
<span class="md-ellipsis">
      Process Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_2">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-notes">
<span class="md-ellipsis">
      Performance Notes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#load_and_indexjsonl_path">
<span class="md-ellipsis">
      load_and_index(jsonl_path)
    </span>
</a>
<nav aria-label="load_and_index(jsonl_path)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_2">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_2">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_3">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-methods">
<span class="md-ellipsis">
      🔍 Search Methods
    </span>
</a>
<nav aria-label="🔍 Search Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#searchquery-limit10-score_thresholdnone-authornone-categorynone">
<span class="md-ellipsis">
      search(query, limit=10, score_threshold=None, author=None, category=None)
    </span>
</a>
<nav aria-label="search(query, limit=10, score_threshold=None, author=None, category=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_3">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_3">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_4">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-tips">
<span class="md-ellipsis">
      Search Tips
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-by-contract_1">
<span class="md-ellipsis">
      Design by Contract
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ai-integration-methods">
<span class="md-ellipsis">
      🤖 AI Integration Methods
    </span>
</a>
<nav aria-label="🤖 AI Integration Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ask_llmuser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o">
<span class="md-ellipsis">
      ask_llm(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o")
    </span>
</a>
<nav aria-label='ask_llm(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_4">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_4">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_5">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#question-ideas">
<span class="md-ellipsis">
      Question Ideas
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ask_llm_simpleuser_query-limit3-modelgpt-4o">
<span class="md-ellipsis">
      ask_llm_simple(user_query, limit=3, model="gpt-4o")
    </span>
</a>
<nav aria-label='ask_llm_simple(user_query, limit=3, model="gpt-4o")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_5">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_5">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#raguser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o-response_typestructured">
<span class="md-ellipsis">
      rag(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o", response_type="structured")
    </span>
</a>
<nav aria-label='rag(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o", response_type="structured")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-complete-rag-pipeline">
<span class="md-ellipsis">
      The Complete RAG Pipeline
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_6">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_6">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_6">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-usage">
<span class="md-ellipsis">
      Advanced Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#display-methods">
<span class="md-ellipsis">
      🎨 Display Methods
    </span>
</a>
<nav aria-label="🎨 Display Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#display_search_resultsresults-search_description-max_text_length120">
<span class="md-ellipsis">
      display_search_results(results, search_description, max_text_length=120)
    </span>
</a>
<nav aria-label="display_search_results(results, search_description, max_text_length=120)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_7">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_7">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#display_llm_responseresponse-user_query">
<span class="md-ellipsis">
      display_llm_response(response, user_query)
    </span>
</a>
<nav aria-label="display_llm_response(response, user_query)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_8">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features_1">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#management-methods">
<span class="md-ellipsis">
      📊 Management Methods
    </span>
</a>
<nav aria-label="📊 Management Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#get_collection_stats">
<span class="md-ellipsis">
      get_collection_stats()
    </span>
</a>
<nav aria-label="get_collection_stats()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_7">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_8">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistency_check">
<span class="md-ellipsis">
      consistency_check()
    </span>
</a>
<nav aria-label="consistency_check()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_8">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-checked">
<span class="md-ellipsis">
      What's Checked
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_9">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recreate_collection">
<span class="md-ellipsis">
      recreate_collection()
    </span>
</a>
<nav aria-label="recreate_collection()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#process">
<span class="md-ellipsis">
      Process
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_10">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#warning">
<span class="md-ellipsis">
      ⚠️ Warning
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag-helper-methods">
<span class="md-ellipsis">
      🔧 RAG Helper Methods
    </span>
</a>
<nav aria-label="🔧 RAG Helper Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#format_search_results_for_ragsearch_results-max_results5">
<span class="md-ellipsis">
      format_search_results_for_rag(search_results, max_results=5)
    </span>
</a>
<nav aria-label="format_search_results_for_rag(search_results, max_results=5)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_9">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_9">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create_rag_contextuser_query-search_results-system_promptnone">
<span class="md-ellipsis">
      create_rag_context(user_query, search_results, system_prompt=None)
    </span>
</a>
<nav aria-label="create_rag_context(user_query, search_results, system_prompt=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_10">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_10">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_and_create_rag_contextuser_query-limit5-kwargs">
<span class="md-ellipsis">
      search_and_create_rag_context(user_query, limit=5, **kwargs)
    </span>
</a>
<nav aria-label="search_and_create_rag_context(user_query, limit=5, **kwargs)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_11">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_11">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-methods">
<span class="md-ellipsis">
      🔒 Private Methods
    </span>
</a>
<nav aria-label="🔒 Private Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_load_system_prompt">
<span class="md-ellipsis">
      _load_system_prompt()
    </span>
</a>
<nav aria-label="_load_system_prompt()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_12">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_apply_metadata_filtersresults-author_filternone-category_filternone">
<span class="md-ellipsis">
      _apply_metadata_filters(results, author_filter=None, category_filter=None)
    </span>
</a>
<nav aria-label="_apply_metadata_filters(results, author_filter=None, category_filter=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_12">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_13">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_display_search_results_simpleresults-search_description-max_text_length">
<span class="md-ellipsis">
      _display_search_results_simple(results, search_description, max_text_length)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_display_llm_response_simpleresponse-user_query">
<span class="md-ellipsis">
      _display_llm_response_simple(response, user_query)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-attributes">
<span class="md-ellipsis">
      📝 Class Attributes
    </span>
</a>
<nav aria-label="📝 Class Attributes" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#system_prompt_path">
<span class="md-ellipsis">
      SYSTEM_PROMPT_PATH
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#animals_rag_system_prompt">
<span class="md-ellipsis">
      ANIMALS_RAG_SYSTEM_PROMPT
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#simple_animals_prompt">
<span class="md-ellipsis">
      SIMPLE_ANIMALS_PROMPT
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      🎯 Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependencies">
<span class="md-ellipsis">
      🔗 Dependencies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#source-code">
<span class="md-ellipsis">
      📚 Source Code
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals">
<span class="md-ellipsis">
      Animals
    </span>
</a>
<nav aria-label="Animals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse">
<span class="md-ellipsis">
      AnimalWisdomResponse
    </span>
</a>
<nav aria-label="AnimalWisdomResponse" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse.validate_answer_length">
<span class="md-ellipsis">
      validate_answer_length
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.ask_llm">
<span class="md-ellipsis">
      ask_llm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.ask_llm_simple">
<span class="md-ellipsis">
      ask_llm_simple
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.consistency_check">
<span class="md-ellipsis">
      consistency_check
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.create_rag_context">
<span class="md-ellipsis">
      create_rag_context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.display_llm_response">
<span class="md-ellipsis">
      display_llm_response
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.display_search_results">
<span class="md-ellipsis">
      display_search_results
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.format_search_results_for_rag">
<span class="md-ellipsis">
      format_search_results_for_rag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.get_collection_stats">
<span class="md-ellipsis">
      get_collection_stats
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.index_all_quotes">
<span class="md-ellipsis">
      index_all_quotes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.index_single_quote">
<span class="md-ellipsis">
      index_single_quote
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.load_and_index">
<span class="md-ellipsis">
      load_and_index
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.load_from_jsonl">
<span class="md-ellipsis">
      load_from_jsonl
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.rag">
<span class="md-ellipsis">
      rag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.recreate_collection">
<span class="md-ellipsis">
      recreate_collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.search">
<span class="md-ellipsis">
      search
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.search_and_create_rag_context">
<span class="md-ellipsis">
      search_and_create_rag_context
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Examples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/">
<span class="md-ellipsis">
    Examples Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Exceptions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Exceptions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../exceptions/">
<span class="md-ellipsis">
    Exceptions Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Notebooks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    Examples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/examples/lesson-1/">
<span class="md-ellipsis">
    Lesson 1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/examples/lesson-2/">
<span class="md-ellipsis">
    Lesson 2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/examples/search-corpus/">
<span class="md-ellipsis">
    Search corpus
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/examples/semantic-search/">
<span class="md-ellipsis">
    Semantic search
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/examples/supportvectors-common/">
<span class="md-ellipsis">
    Supportvectors common
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Project guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Project guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
<span class="md-ellipsis">
    Tips and tricks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_1">
<span class="md-nav__icon md-icon"></span>
            Tips and tricks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../project-guide/tips-and-tricks/cuda-hell/">
<span class="md-ellipsis">
    Some tips and tricks to deal with the CUDA hell
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Search
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Search
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../search/">
<span class="md-ellipsis">
    Search Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Search basics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Search basics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../search_basics/">
<span class="md-ellipsis">
    Search Basics Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Start simply
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Start simply
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../start_simply/">
<span class="md-ellipsis">
    Start Simply Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    Utils
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            Utils
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/">
<span class="md-ellipsis">
    Utils Package
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
<span class="md-ellipsis">
    Vectordb
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_11">
<span class="md-nav__icon md-icon"></span>
            Vectordb
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../vectordb/">
<span class="md-ellipsis">
    Vector Database Package: Embeddings and Storage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../vectordb/EmbeddedVectorDB/">
<span class="md-ellipsis">
    EmbeddedVectorDB Class
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../vectordb/SimpleTextEmbedder/">
<span class="md-ellipsis">
    SimpleTextEmbedder Class
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-overview">
<span class="md-ellipsis">
      🎯 Class Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-definition">
<span class="md-ellipsis">
      📋 Class Definition
    </span>
</a>
<nav aria-label="📋 Class Definition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-architecture">
<span class="md-ellipsis">
      🏗️ Class Architecture
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-features">
<span class="md-ellipsis">
      🚀 Key Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constructor">
<span class="md-ellipsis">
      📖 Constructor
    </span>
</a>
<nav aria-label="📖 Constructor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#__init__vector_db-embeddernone-collection_nameanimals">
<span class="md-ellipsis">
      __init__(vector_db, embedder=None, collection_name="animals")
    </span>
</a>
<nav aria-label='__init__(vector_db, embedder=None, collection_name="animals")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-by-contract">
<span class="md-ellipsis">
      Design by Contract
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-loading-methods">
<span class="md-ellipsis">
      📥 Data Loading Methods
    </span>
</a>
<nav aria-label="📥 Data Loading Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#load_from_jsonljsonl_path">
<span class="md-ellipsis">
      load_from_jsonl(jsonl_path)
    </span>
</a>
<nav aria-label="load_from_jsonl(jsonl_path)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_1">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#expected-jsonl-format">
<span class="md-ellipsis">
      Expected JSONL Format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_1">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#index_all_quotes">
<span class="md-ellipsis">
      index_all_quotes()
    </span>
</a>
<nav aria-label="index_all_quotes()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_1">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#process-flow">
<span class="md-ellipsis">
      Process Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_2">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-notes">
<span class="md-ellipsis">
      Performance Notes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#load_and_indexjsonl_path">
<span class="md-ellipsis">
      load_and_index(jsonl_path)
    </span>
</a>
<nav aria-label="load_and_index(jsonl_path)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_2">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_2">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_3">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-methods">
<span class="md-ellipsis">
      🔍 Search Methods
    </span>
</a>
<nav aria-label="🔍 Search Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#searchquery-limit10-score_thresholdnone-authornone-categorynone">
<span class="md-ellipsis">
      search(query, limit=10, score_threshold=None, author=None, category=None)
    </span>
</a>
<nav aria-label="search(query, limit=10, score_threshold=None, author=None, category=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_3">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_3">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_4">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-tips">
<span class="md-ellipsis">
      Search Tips
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-by-contract_1">
<span class="md-ellipsis">
      Design by Contract
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ai-integration-methods">
<span class="md-ellipsis">
      🤖 AI Integration Methods
    </span>
</a>
<nav aria-label="🤖 AI Integration Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ask_llmuser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o">
<span class="md-ellipsis">
      ask_llm(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o")
    </span>
</a>
<nav aria-label='ask_llm(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_4">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_4">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_5">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#question-ideas">
<span class="md-ellipsis">
      Question Ideas
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ask_llm_simpleuser_query-limit3-modelgpt-4o">
<span class="md-ellipsis">
      ask_llm_simple(user_query, limit=3, model="gpt-4o")
    </span>
</a>
<nav aria-label='ask_llm_simple(user_query, limit=3, model="gpt-4o")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_5">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_5">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#raguser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o-response_typestructured">
<span class="md-ellipsis">
      rag(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o", response_type="structured")
    </span>
</a>
<nav aria-label='rag(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o", response_type="structured")' class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-complete-rag-pipeline">
<span class="md-ellipsis">
      The Complete RAG Pipeline
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_6">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_6">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_6">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-usage">
<span class="md-ellipsis">
      Advanced Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#display-methods">
<span class="md-ellipsis">
      🎨 Display Methods
    </span>
</a>
<nav aria-label="🎨 Display Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#display_search_resultsresults-search_description-max_text_length120">
<span class="md-ellipsis">
      display_search_results(results, search_description, max_text_length=120)
    </span>
</a>
<nav aria-label="display_search_results(results, search_description, max_text_length=120)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_7">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_7">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#display_llm_responseresponse-user_query">
<span class="md-ellipsis">
      display_llm_response(response, user_query)
    </span>
</a>
<nav aria-label="display_llm_response(response, user_query)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_8">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features_1">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#management-methods">
<span class="md-ellipsis">
      📊 Management Methods
    </span>
</a>
<nav aria-label="📊 Management Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#get_collection_stats">
<span class="md-ellipsis">
      get_collection_stats()
    </span>
</a>
<nav aria-label="get_collection_stats()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_7">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_8">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistency_check">
<span class="md-ellipsis">
      consistency_check()
    </span>
</a>
<nav aria-label="consistency_check()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_8">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-checked">
<span class="md-ellipsis">
      What's Checked
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_9">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recreate_collection">
<span class="md-ellipsis">
      recreate_collection()
    </span>
</a>
<nav aria-label="recreate_collection()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#process">
<span class="md-ellipsis">
      Process
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-usage_10">
<span class="md-ellipsis">
      Example Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#warning">
<span class="md-ellipsis">
      ⚠️ Warning
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag-helper-methods">
<span class="md-ellipsis">
      🔧 RAG Helper Methods
    </span>
</a>
<nav aria-label="🔧 RAG Helper Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#format_search_results_for_ragsearch_results-max_results5">
<span class="md-ellipsis">
      format_search_results_for_rag(search_results, max_results=5)
    </span>
</a>
<nav aria-label="format_search_results_for_rag(search_results, max_results=5)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_9">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_9">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create_rag_contextuser_query-search_results-system_promptnone">
<span class="md-ellipsis">
      create_rag_context(user_query, search_results, system_prompt=None)
    </span>
</a>
<nav aria-label="create_rag_context(user_query, search_results, system_prompt=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_10">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_10">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_and_create_rag_contextuser_query-limit5-kwargs">
<span class="md-ellipsis">
      search_and_create_rag_context(user_query, limit=5, **kwargs)
    </span>
</a>
<nav aria-label="search_and_create_rag_context(user_query, limit=5, **kwargs)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_11">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_11">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-methods">
<span class="md-ellipsis">
      🔒 Private Methods
    </span>
</a>
<nav aria-label="🔒 Private Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_load_system_prompt">
<span class="md-ellipsis">
      _load_system_prompt()
    </span>
</a>
<nav aria-label="_load_system_prompt()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_12">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_apply_metadata_filtersresults-author_filternone-category_filternone">
<span class="md-ellipsis">
      _apply_metadata_filters(results, author_filter=None, category_filter=None)
    </span>
</a>
<nav aria-label="_apply_metadata_filters(results, author_filter=None, category_filter=None)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parameters_12">
<span class="md-ellipsis">
      Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#returns_13">
<span class="md-ellipsis">
      Returns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_display_search_results_simpleresults-search_description-max_text_length">
<span class="md-ellipsis">
      _display_search_results_simple(results, search_description, max_text_length)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_display_llm_response_simpleresponse-user_query">
<span class="md-ellipsis">
      _display_llm_response_simple(response, user_query)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-attributes">
<span class="md-ellipsis">
      📝 Class Attributes
    </span>
</a>
<nav aria-label="📝 Class Attributes" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#system_prompt_path">
<span class="md-ellipsis">
      SYSTEM_PROMPT_PATH
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#animals_rag_system_prompt">
<span class="md-ellipsis">
      ANIMALS_RAG_SYSTEM_PROMPT
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#simple_animals_prompt">
<span class="md-ellipsis">
      SIMPLE_ANIMALS_PROMPT
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      🎯 Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependencies">
<span class="md-ellipsis">
      🔗 Dependencies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#source-code">
<span class="md-ellipsis">
      📚 Source Code
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals">
<span class="md-ellipsis">
      Animals
    </span>
</a>
<nav aria-label="Animals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse">
<span class="md-ellipsis">
      AnimalWisdomResponse
    </span>
</a>
<nav aria-label="AnimalWisdomResponse" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse.validate_answer_length">
<span class="md-ellipsis">
      validate_answer_length
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.ask_llm">
<span class="md-ellipsis">
      ask_llm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.ask_llm_simple">
<span class="md-ellipsis">
      ask_llm_simple
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.consistency_check">
<span class="md-ellipsis">
      consistency_check
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.create_rag_context">
<span class="md-ellipsis">
      create_rag_context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.display_llm_response">
<span class="md-ellipsis">
      display_llm_response
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.display_search_results">
<span class="md-ellipsis">
      display_search_results
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.format_search_results_for_rag">
<span class="md-ellipsis">
      format_search_results_for_rag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.get_collection_stats">
<span class="md-ellipsis">
      get_collection_stats
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.index_all_quotes">
<span class="md-ellipsis">
      index_all_quotes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.index_single_quote">
<span class="md-ellipsis">
      index_single_quote
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.load_and_index">
<span class="md-ellipsis">
      load_and_index
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.load_from_jsonl">
<span class="md-ellipsis">
      load_from_jsonl
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.rag">
<span class="md-ellipsis">
      rag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.recreate_collection">
<span class="md-ellipsis">
      recreate_collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.search">
<span class="md-ellipsis">
      search
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rag_to_riches.corpus.animals.Animals.search_and_create_rag_context">
<span class="md-ellipsis">
      search_and_create_rag_context
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="animals-class-complete-rag-system">Animals Class: Complete RAG System<a class="headerlink" href="#animals-class-complete-rag-system" title="Permanent link">¶</a></h1>
<h2 id="class-overview">🎯 Class Overview<a class="headerlink" href="#class-overview" title="Permanent link">¶</a></h2>
<p>The <code>Animals</code> class is the flagship component of the RAG to Riches framework - a powerful, intelligent corpus loader that combines semantic search, vector databases, and AI-powered question answering into a single, easy-to-use interface.</p>
<p>This class provides a complete solution for working with collections of animal quotes, offering semantic search, AI-powered question answering, and beautiful result display. Perfect for educational applications, research, or building chatbots that need access to animal wisdom and quotes.</p>
<h2 id="class-definition">📋 Class Definition<a class="headerlink" href="#class-definition" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Animals</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A powerful, intelligent corpus loader for animal quotes with RAG capabilities."""</span>
</code></pre></div>
<h3 id="class-architecture">🏗️ Class Architecture<a class="headerlink" href="#class-architecture" title="Permanent link">¶</a></h3>
<div class="mermaid">classDiagram
    class Animals {
        +SimpleTextEmbedder embedder
        +str collection_name
        +Optional[AnimalWisdom] wisdom
        +SemanticSearch semantic_search
        +str ANIMALS_RAG_SYSTEM_PROMPT
        +Path SYSTEM_PROMPT_PATH

        +__init__(vector_db, embedder, collection_name)
        +load_from_jsonl(jsonl_path) AnimalWisdom
        +index_all_quotes() List[str]
        +search(query, limit, filters) List[ScoredPoint]
        +ask_llm(query, filters, model) AnimalWisdomResponse
        +rag(query, filters, response_type) Dict[str, Any]
        +display_search_results(results, description)
        +get_collection_stats() Dict[str, Any]
        +consistency_check() bool
        +recreate_collection() None

        -_load_system_prompt() str
        -_apply_metadata_filters() List[ScoredPoint]
        -_display_search_results_simple() None
        -_display_llm_response_simple() None
    }

    class AnimalWisdomResponse {
        +str answer
        +List[str] key_insights
        +List[str] recommended_quotes
        +List[str] follow_up_questions
    }

    Animals --&gt; SemanticSearch : uses
    Animals --&gt; EmbeddedVectorDB : uses
    Animals --&gt; AnimalWisdom : manages
    Animals --&gt; AnimalWisdomResponse : creates
</div>
<h2 id="key-features">🚀 Key Features<a class="headerlink" href="#key-features" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Complete RAG Pipeline</strong>: Search + LLM response in a single method call</li>
<li><strong>Semantic Search</strong>: Advanced sentence transformer embeddings for meaning-based retrieval</li>
<li><strong>AI Integration</strong>: OpenAI GPT models with structured response generation</li>
<li><strong>Rich Display</strong>: Beautiful formatted output with Rich library</li>
<li><strong>Batch Operations</strong>: Efficient handling of large quote collections</li>
<li><strong>Metadata Filtering</strong>: Filter by author, category, or similarity score</li>
<li><strong>Health Monitoring</strong>: Collection statistics and consistency checks</li>
</ul>
<h2 id="constructor">📖 Constructor<a class="headerlink" href="#constructor" title="Permanent link">¶</a></h2>
<h3 id="__init__vector_db-embeddernone-collection_nameanimals"><code>__init__(vector_db, embedder=None, collection_name="animals")</code><a class="headerlink" href="#__init__vector_db-embeddernone-collection_nameanimals" title="Permanent link">¶</a></h3>
<p>Initialize your Animals quote corpus with intelligent search capabilities.</p>
<h4 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>vector_db</code></td>
<td><code>EmbeddedVectorDB</code></td>
<td>Required</td>
<td>Vector database instance for storage</td>
</tr>
<tr>
<td><code>embedder</code></td>
<td><code>SimpleTextEmbedder</code></td>
<td><code>None</code></td>
<td>Text embedding model (uses default if None)</td>
</tr>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td><code>"animals"</code></td>
<td>Unique name for your quote collection</td>
</tr>
</tbody>
</table>
<h4 id="example-usage">Example Usage<a class="headerlink" href="#example-usage" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rag_to_riches.vectordb.embedded_vectordb</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmbeddedVectorDB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rag_to_riches.corpus.animals</span><span class="w"> </span><span class="kn">import</span> <span class="n">Animals</span>

<span class="c1"># Basic setup with default embedder</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">EmbeddedVectorDB</span><span class="p">()</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span><span class="n">vector_db</span><span class="p">)</span>

<span class="c1"># Custom setup with specific collection</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span>
    <span class="n">vector_db</span><span class="o">=</span><span class="n">vector_db</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">"philosophical_animal_quotes"</span>
<span class="p">)</span>

<span class="c1"># Advanced setup with custom embedder</span>
<span class="n">custom_embedder</span> <span class="o">=</span> <span class="n">SimpleTextEmbedder</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">"custom-model"</span><span class="p">)</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="n">custom_embedder</span><span class="p">)</span>
</code></pre></div>
<h4 id="design-by-contract">Design by Contract<a class="headerlink" href="#design-by-contract" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Preconditions</strong>: </li>
<li><code>vector_db</code> must be an <code>EmbeddedVectorDB</code> instance</li>
<li><code>embedder</code> must be <code>None</code> or a <code>SimpleTextEmbedder</code> instance</li>
<li><strong>Postconditions</strong>: All required attributes are initialized</li>
</ul>
<h2 id="data-loading-methods">📥 Data Loading Methods<a class="headerlink" href="#data-loading-methods" title="Permanent link">¶</a></h2>
<h3 id="load_from_jsonljsonl_path"><code>load_from_jsonl(jsonl_path)</code><a class="headerlink" href="#load_from_jsonljsonl_path" title="Permanent link">¶</a></h3>
<p>Load and validate animal quotes from a JSONL (JSON Lines) file.</p>
<h4 id="parameters_1">Parameters<a class="headerlink" href="#parameters_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jsonl_path</code></td>
<td><code>Path</code></td>
<td>Path to JSONL file containing animal quotes</td>
</tr>
</tbody>
</table>
<h4 id="returns">Returns<a class="headerlink" href="#returns" title="Permanent link">¶</a></h4>
<p><code>AnimalWisdom</code> - Validated collection of quotes ready for indexing</p>
<h4 id="expected-jsonl-format">Expected JSONL Format<a class="headerlink" href="#expected-jsonl-format" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dogs are not our whole life, but they make our lives whole."</span><span class="p">,</span><span class="w"> </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Roger Caras"</span><span class="p">,</span><span class="w"> </span><span class="nt">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pets and Companionship"</span><span class="p">}</span>
<span class="p">{</span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The greatness of a nation can be judged by the way its animals are treated."</span><span class="p">,</span><span class="w"> </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mahatma Gandhi"</span><span class="p">,</span><span class="w"> </span><span class="nt">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ethics and Compassion"</span><span class="p">}</span>
</code></pre></div>
<h4 id="example-usage_1">Example Usage<a class="headerlink" href="#example-usage_1" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Load quotes from file</span>
<span class="n">quotes_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"data/animal_wisdom.jsonl"</span><span class="p">)</span>
<span class="n">wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="n">quotes_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wisdom</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Categories: </span><span class="si">{</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_categories</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Authors: </span><span class="si">{</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_authors</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Access individual quotes</span>
<span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">" - </span><span class="si">{</span><span class="n">quote</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
<h4 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">¶</a></h4>
<ul>
<li><strong><code>FileNotFoundError</code></strong>: When the specified file doesn't exist</li>
<li><strong><code>InvalidPointsError</code></strong>: When no valid quotes are found in the file</li>
</ul>
<h3 id="index_all_quotes"><code>index_all_quotes()</code><a class="headerlink" href="#index_all_quotes" title="Permanent link">¶</a></h3>
<p>Transform all loaded quotes into searchable vector embeddings.</p>
<h4 id="returns_1">Returns<a class="headerlink" href="#returns_1" title="Permanent link">¶</a></h4>
<p><code>List[str]</code> - List of unique point IDs for each indexed quote</p>
<h4 id="process-flow">Process Flow<a class="headerlink" href="#process-flow" title="Permanent link">¶</a></h4>
<ol>
<li>Extracts text content from each quote</li>
<li>Generates semantic embeddings using the configured model</li>
<li>Stores vectors in the database with rich metadata</li>
<li>Creates searchable points for instant retrieval</li>
</ol>
<h4 id="example-usage_2">Example Usage<a class="headerlink" href="#example-usage_2" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Load quotes first</span>
<span class="n">wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="s2">"quotes.jsonl"</span><span class="p">)</span>

<span class="c1"># Index for semantic search</span>
<span class="n">point_ids</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully indexed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">point_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes"</span><span class="p">)</span>

<span class="c1"># Now you can search semantically</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"loyalty and friendship"</span><span class="p">)</span>
</code></pre></div>
<h4 id="performance-notes">Performance Notes<a class="headerlink" href="#performance-notes" title="Permanent link">¶</a></h4>
<ul>
<li>Batch processing is used for efficiency with large collections</li>
<li>Indexing time scales with collection size and model complexity</li>
<li>Typical speed: ~100-500 quotes per second depending on hardware</li>
<li>GPU acceleration automatically used if available</li>
</ul>
<h3 id="load_and_indexjsonl_path"><code>load_and_index(jsonl_path)</code><a class="headerlink" href="#load_and_indexjsonl_path" title="Permanent link">¶</a></h3>
<p>One-step solution: load quotes from file and make them instantly searchable.</p>
<h4 id="parameters_2">Parameters<a class="headerlink" href="#parameters_2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jsonl_path</code></td>
<td><code>Path</code></td>
<td>Path to JSONL file containing animal quotes</td>
</tr>
</tbody>
</table>
<h4 id="returns_2">Returns<a class="headerlink" href="#returns_2" title="Permanent link">¶</a></h4>
<p><code>Tuple[AnimalWisdom, List[str]]</code> - Loaded wisdom and point IDs</p>
<h4 id="example-usage_3">Example Usage<a class="headerlink" href="#example-usage_3" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Complete setup in one line</span>
<span class="n">wisdom</span><span class="p">,</span> <span class="n">point_ids</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_and_index</span><span class="p">(</span><span class="s2">"my_quotes.jsonl"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ready to search </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wisdom</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes!"</span><span class="p">)</span>

<span class="c1"># Immediately start searching</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"courage and bravery"</span><span class="p">)</span>
</code></pre></div>
<h2 id="search-methods">🔍 Search Methods<a class="headerlink" href="#search-methods" title="Permanent link">¶</a></h2>
<h3 id="searchquery-limit10-score_thresholdnone-authornone-categorynone"><code>search(query, limit=10, score_threshold=None, author=None, category=None)</code><a class="headerlink" href="#searchquery-limit10-score_thresholdnone-authornone-categorynone" title="Permanent link">¶</a></h3>
<p>Find the most relevant animal quotes using intelligent semantic search.</p>
<h4 id="parameters_3">Parameters<a class="headerlink" href="#parameters_3" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>Search question or topic in natural language</td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td><code>10</code></td>
<td>Maximum number of results to return</td>
</tr>
<tr>
<td><code>score_threshold</code></td>
<td><code>float</code></td>
<td><code>None</code></td>
<td>Minimum similarity score (0.0-1.0)</td>
</tr>
<tr>
<td><code>author</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Filter to only include quotes by this author</td>
</tr>
<tr>
<td><code>category</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Filter to only include quotes from this category</td>
</tr>
</tbody>
</table>
<h4 id="returns_3">Returns<a class="headerlink" href="#returns_3" title="Permanent link">¶</a></h4>
<p><code>List[models.ScoredPoint]</code> - Results sorted by relevance (highest scores first)</p>
<h4 id="example-usage_4">Example Usage<a class="headerlink" href="#example-usage_4" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Basic semantic search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"loyalty and friendship"</span><span class="p">)</span>

<span class="c1"># Precise search with high threshold</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"courage in difficult times"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>

<span class="c1"># Search within specific author's quotes</span>
<span class="n">gandhi_quotes</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"compassion"</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">"Mahatma Gandhi"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="c1"># Browse by category</span>
<span class="n">wisdom_quotes</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"life lessons"</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">"Wisdom and Philosophy"</span>
<span class="p">)</span>

<span class="c1"># Process results</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Score: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quote: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Author: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"---"</span><span class="p">)</span>
</code></pre></div>
<h4 id="search-tips">Search Tips<a class="headerlink" href="#search-tips" title="Permanent link">¶</a></h4>
<ul>
<li>Use descriptive phrases rather than single keywords</li>
<li>Try different phrasings if you don't find what you're looking for</li>
<li>Lower the score_threshold to see more diverse results</li>
<li>Combine filters to narrow down to specific types of quotes</li>
</ul>
<h4 id="design-by-contract_1">Design by Contract<a class="headerlink" href="#design-by-contract_1" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Preconditions</strong>:</li>
<li><code>query</code> must be a non-empty string</li>
<li><code>limit</code> must be a positive integer</li>
<li><code>author</code> and <code>category</code> filters must be None or non-empty strings</li>
<li><strong>Postconditions</strong>: Returns a list of ScoredPoint objects</li>
</ul>
<h2 id="ai-integration-methods">🤖 AI Integration Methods<a class="headerlink" href="#ai-integration-methods" title="Permanent link">¶</a></h2>
<h3 id="ask_llmuser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o"><code>ask_llm(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o")</code><a class="headerlink" href="#ask_llmuser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o" title="Permanent link">¶</a></h3>
<p>Ask AI thoughtful questions about animals and get structured, insightful answers.</p>
<h4 id="parameters_4">Parameters<a class="headerlink" href="#parameters_4" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_query</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>Your question about animals</td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td><code>5</code></td>
<td>Number of relevant quotes to provide as context</td>
</tr>
<tr>
<td><code>score_threshold</code></td>
<td><code>float</code></td>
<td><code>None</code></td>
<td>Only use quotes above this similarity score</td>
</tr>
<tr>
<td><code>author</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Focus on quotes from this specific author</td>
</tr>
<tr>
<td><code>category</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Limit context to quotes from this category</td>
</tr>
<tr>
<td><code>model</code></td>
<td><code>str</code></td>
<td><code>"gpt-4o"</code></td>
<td>OpenAI model to use</td>
</tr>
</tbody>
</table>
<h4 id="returns_4">Returns<a class="headerlink" href="#returns_4" title="Permanent link">¶</a></h4>
<p><code>AnimalWisdomResponse</code> - Structured response containing:
- <code>answer</code>: Comprehensive, thoughtful response
- <code>key_insights</code>: 2-5 main themes or takeaways
- <code>recommended_quotes</code>: Most relevant quotes with attribution
- <code>follow_up_questions</code>: Suggested related questions</p>
<h4 id="example-usage_5">Example Usage<a class="headerlink" href="#example-usage_5" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Ask a philosophical question</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">ask_llm</span><span class="p">(</span>
    <span class="s2">"What can animals teach us about resilience and survival?"</span>
<span class="p">)</span>

<span class="c1"># Display the structured response</span>
<span class="n">animals</span><span class="o">.</span><span class="n">display_llm_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">"resilience question"</span><span class="p">)</span>

<span class="c1"># Access specific parts</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Main Answer:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Key Insights:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">insight</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">key_insights</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"- </span><span class="si">{</span><span class="n">insight</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Ask follow-up questions</span>
<span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Next: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h4 id="question-ideas">Question Ideas<a class="headerlink" href="#question-ideas" title="Permanent link">¶</a></h4>
<ul>
<li>"How do animals demonstrate unconditional love?"</li>
<li>"What survival strategies can humans learn from animals?"</li>
<li>"How do different cultures view human-animal relationships?"</li>
<li>"What role do animals play in teaching empathy?"</li>
</ul>
<h3 id="ask_llm_simpleuser_query-limit3-modelgpt-4o"><code>ask_llm_simple(user_query, limit=3, model="gpt-4o")</code><a class="headerlink" href="#ask_llm_simpleuser_query-limit3-modelgpt-4o" title="Permanent link">¶</a></h3>
<p>Get a simple text response from the LLM about animals.</p>
<h4 id="parameters_5">Parameters<a class="headerlink" href="#parameters_5" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_query</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>Your question about animals</td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td><code>3</code></td>
<td>Maximum number of search results to include</td>
</tr>
<tr>
<td><code>model</code></td>
<td><code>str</code></td>
<td><code>"gpt-4o"</code></td>
<td>OpenAI model to use</td>
</tr>
</tbody>
</table>
<h4 id="returns_5">Returns<a class="headerlink" href="#returns_5" title="Permanent link">¶</a></h4>
<p><code>str</code> - Simple text response from the LLM</p>
<h3 id="raguser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o-response_typestructured"><code>rag(user_query, limit=5, score_threshold=None, author=None, category=None, model="gpt-4o", response_type="structured")</code><a class="headerlink" href="#raguser_query-limit5-score_thresholdnone-authornone-categorynone-modelgpt-4o-response_typestructured" title="Permanent link">¶</a></h3>
<p>🚀 Complete AI-powered question answering in one powerful method call.</p>
<p>This is your one-stop solution for getting intelligent answers about animals. It automatically searches your quote collection, finds the most relevant content, and generates comprehensive AI responses with full transparency into the process.</p>
<h4 id="the-complete-rag-pipeline">The Complete RAG Pipeline<a class="headerlink" href="#the-complete-rag-pipeline" title="Permanent link">¶</a></h4>
<ol>
<li>🔍 Semantic search finds relevant quotes from your collection</li>
<li>📝 Context generation creates optimized prompts for the AI</li>
<li>🤖 AI reasoning produces thoughtful, grounded responses</li>
<li>📊 Full transparency with all intermediate results returned</li>
</ol>
<h4 id="parameters_6">Parameters<a class="headerlink" href="#parameters_6" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_query</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>Your question about animals</td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td><code>5</code></td>
<td>Number of quotes to use as context</td>
</tr>
<tr>
<td><code>score_threshold</code></td>
<td><code>float</code></td>
<td><code>None</code></td>
<td>Minimum relevance score for quotes</td>
</tr>
<tr>
<td><code>author</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Limit context to quotes from this author</td>
</tr>
<tr>
<td><code>category</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Focus on quotes from this category</td>
</tr>
<tr>
<td><code>model</code></td>
<td><code>str</code></td>
<td><code>"gpt-4o"</code></td>
<td>OpenAI model for AI responses</td>
</tr>
<tr>
<td><code>response_type</code></td>
<td><code>str</code></td>
<td><code>"structured"</code></td>
<td>"structured" or "simple" response format</td>
</tr>
</tbody>
</table>
<h4 id="returns_6">Returns<a class="headerlink" href="#returns_6" title="Permanent link">¶</a></h4>
<p><code>Dict[str, Any]</code> - Complete results dictionary containing:
- <code>llm_response</code>: AI answer (structured object or simple string)
- <code>search_results</code>: List of relevant quotes found (with scores)
- <code>rag_context</code>: Full prompt sent to AI (for debugging/transparency)
- <code>query_info</code>: Metadata about the query and processing parameters</p>
<h4 id="example-usage_6">Example Usage<a class="headerlink" href="#example-usage_6" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Complete RAG in one call</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"What do animals teach us about unconditional love?"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">response_type</span><span class="o">=</span><span class="s2">"structured"</span>
<span class="p">)</span>

<span class="c1"># Access the AI response</span>
<span class="n">ai_answer</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"llm_response"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"AI Answer:"</span><span class="p">,</span> <span class="n">ai_answer</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>

<span class="c1"># See what quotes were used</span>
<span class="n">quotes_used</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"search_results"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Based on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">quotes_used</span><span class="p">)</span><span class="si">}</span><span class="s2"> relevant quotes"</span><span class="p">)</span>

<span class="c1"># Inspect the full context (for debugging)</span>
<span class="n">full_prompt</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"rag_context"</span><span class="p">]</span>

<span class="c1"># Get query metadata</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"query_info"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Model: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'model'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Results: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'results_count'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h4 id="advanced-usage">Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Domain-specific question</span>
<span class="n">ethics_result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"How should humans treat wild animals?"</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">"Ethics and Compassion"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="c1"># Author-focused inquiry</span>
<span class="n">gandhi_result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"What did Gandhi believe about animals?"</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">"Mahatma Gandhi"</span><span class="p">,</span>
    <span class="n">response_type</span><span class="o">=</span><span class="s2">"simple"</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="display-methods">🎨 Display Methods<a class="headerlink" href="#display-methods" title="Permanent link">¶</a></h2>
<h3 id="display_search_resultsresults-search_description-max_text_length120"><code>display_search_results(results, search_description, max_text_length=120)</code><a class="headerlink" href="#display_search_resultsresults-search_description-max_text_length120" title="Permanent link">¶</a></h3>
<p>Present search results in a beautiful, easy-to-read table format.</p>
<h4 id="parameters_7">Parameters<a class="headerlink" href="#parameters_7" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>results</code></td>
<td><code>List[models.ScoredPoint]</code></td>
<td>Required</td>
<td>Search results to display</td>
</tr>
<tr>
<td><code>search_description</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>Descriptive title for the search</td>
</tr>
<tr>
<td><code>max_text_length</code></td>
<td><code>int</code></td>
<td><code>120</code></td>
<td>Maximum characters before truncation</td>
</tr>
</tbody>
</table>
<h4 id="features">Features<a class="headerlink" href="#features" title="Permanent link">¶</a></h4>
<ul>
<li>🎨 Color-coded columns for easy scanning</li>
<li>📊 Relevance scores prominently displayed</li>
<li>✂️ Smart text truncation to maintain readability</li>
<li>📱 Responsive layout that works in various terminal sizes</li>
<li>🚫 Graceful handling of empty results</li>
</ul>
<h4 id="example-usage_7">Example Usage<a class="headerlink" href="#example-usage_7" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Search and display results beautifully</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"courage and bravery"</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">display_search_results</span><span class="p">(</span>
    <span class="n">results</span><span class="p">,</span> 
    <span class="s2">"Quotes about Courage and Bravery"</span><span class="p">,</span>
    <span class="n">max_text_length</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="display_llm_responseresponse-user_query"><code>display_llm_response(response, user_query)</code><a class="headerlink" href="#display_llm_responseresponse-user_query" title="Permanent link">¶</a></h3>
<p>Display the LLM response in a formatted way using Rich.</p>
<h4 id="parameters_8">Parameters<a class="headerlink" href="#parameters_8" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>response</code></td>
<td><code>AnimalWisdomResponse</code></td>
<td>Structured response from the LLM</td>
</tr>
<tr>
<td><code>user_query</code></td>
<td><code>str</code></td>
<td>Original user query</td>
</tr>
</tbody>
</table>
<h4 id="features_1">Features<a class="headerlink" href="#features_1" title="Permanent link">¶</a></h4>
<ul>
<li>🤖 Main answer in highlighted panel</li>
<li>💡 Key insights in organized list</li>
<li>📚 Recommended quotes with attribution</li>
<li>🔍 Follow-up questions for continued exploration</li>
</ul>
<h2 id="management-methods">📊 Management Methods<a class="headerlink" href="#management-methods" title="Permanent link">¶</a></h2>
<h3 id="get_collection_stats"><code>get_collection_stats()</code><a class="headerlink" href="#get_collection_stats" title="Permanent link">¶</a></h3>
<p>Get comprehensive statistics and insights about your quote collection.</p>
<h4 id="returns_7">Returns<a class="headerlink" href="#returns_7" title="Permanent link">¶</a></h4>
<p><code>Dict[str, Any]</code> - Dictionary containing detailed statistics:
- <code>collection_name</code>: Name of your quote collection
- <code>collection_exists</code>: Whether the database collection exists
- <code>point_count</code>: Total quotes stored in the database
- <code>loaded_quotes</code>: Number of quotes currently loaded in memory
- <code>categories</code>: List of all unique quote categories (sorted)
- <code>authors</code>: List of all unique authors (sorted)</p>
<h4 id="example-usage_8">Example Usage<a class="headerlink" href="#example-usage_8" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">stats</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">get_collection_stats</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Collection: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'collection_name'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total quotes in database: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'point_count'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quotes loaded in memory: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'loaded_quotes'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Categories (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">'categories'</span><span class="p">])</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'categories'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Authors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">'authors'</span><span class="p">])</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'authors'</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>

<span class="c1"># Check if ready for search</span>
<span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">'collection_exists'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">stats</span><span class="p">[</span><span class="s1">'point_count'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"✅ Ready for semantic search!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"❌ Need to load and index quotes first"</span><span class="p">)</span>
</code></pre></div>
<h3 id="consistency_check"><code>consistency_check()</code><a class="headerlink" href="#consistency_check" title="Permanent link">¶</a></h3>
<p>Verify that your database collection is properly configured and ready to use.</p>
<h4 id="returns_8">Returns<a class="headerlink" href="#returns_8" title="Permanent link">¶</a></h4>
<p><code>bool</code> - True if everything is properly configured, False if issues detected</p>
<h4 id="whats-checked">What's Checked<a class="headerlink" href="#whats-checked" title="Permanent link">¶</a></h4>
<ul>
<li>Vector dimensions match between collection and embedder</li>
<li>Distance metric compatibility</li>
<li>Collection existence and accessibility</li>
<li>Basic connectivity to the vector database</li>
</ul>
<h4 id="example-usage_9">Example Usage<a class="headerlink" href="#example-usage_9" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">animals</span><span class="o">.</span><span class="n">consistency_check</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"✅ Collection is healthy and ready!"</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"your query here"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"❌ Configuration issues detected"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Consider recreating the collection:"</span><span class="p">)</span>
    <span class="n">animals</span><span class="o">.</span><span class="n">recreate_collection</span><span class="p">()</span>
</code></pre></div>
<h3 id="recreate_collection"><code>recreate_collection()</code><a class="headerlink" href="#recreate_collection" title="Permanent link">¶</a></h3>
<p>Completely reset your quote collection with a fresh, empty database.</p>
<h4 id="process">Process<a class="headerlink" href="#process" title="Permanent link">¶</a></h4>
<ol>
<li>Safely deletes the existing collection if it exists</li>
<li>Creates a new empty collection with optimal settings</li>
<li>Clears all loaded quote data from memory</li>
<li>Prepares the system for fresh data loading</li>
</ol>
<h4 id="example-usage_10">Example Usage<a class="headerlink" href="#example-usage_10" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Reset everything and start fresh</span>
<span class="n">animals</span><span class="o">.</span><span class="n">recreate_collection</span><span class="p">()</span>

<span class="c1"># Now load new data</span>
<span class="n">new_wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="s2">"updated_quotes.jsonl"</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
</code></pre></div>
<h4 id="warning">⚠️ Warning<a class="headerlink" href="#warning" title="Permanent link">¶</a></h4>
<p>This operation is irreversible! All existing quotes in the collection will be permanently deleted. Make sure you have backups of important data before calling this method.</p>
<h2 id="rag-helper-methods">🔧 RAG Helper Methods<a class="headerlink" href="#rag-helper-methods" title="Permanent link">¶</a></h2>
<h3 id="format_search_results_for_ragsearch_results-max_results5"><code>format_search_results_for_rag(search_results, max_results=5)</code><a class="headerlink" href="#format_search_results_for_ragsearch_results-max_results5" title="Permanent link">¶</a></h3>
<p>Format search results for RAG system prompt.</p>
<h4 id="parameters_9">Parameters<a class="headerlink" href="#parameters_9" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>search_results</code></td>
<td><code>List[models.ScoredPoint]</code></td>
<td>Required</td>
<td>Search results to format</td>
</tr>
<tr>
<td><code>max_results</code></td>
<td><code>int</code></td>
<td><code>5</code></td>
<td>Maximum number of results to include</td>
</tr>
</tbody>
</table>
<h4 id="returns_9">Returns<a class="headerlink" href="#returns_9" title="Permanent link">¶</a></h4>
<p><code>str</code> - Formatted string for RAG context</p>
<h3 id="create_rag_contextuser_query-search_results-system_promptnone"><code>create_rag_context(user_query, search_results, system_prompt=None)</code><a class="headerlink" href="#create_rag_contextuser_query-search_results-system_promptnone" title="Permanent link">¶</a></h3>
<p>Create a complete RAG context with system prompt and formatted results.</p>
<h4 id="parameters_10">Parameters<a class="headerlink" href="#parameters_10" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_query</code></td>
<td><code>str</code></td>
<td>Required</td>
<td>The user's question</td>
</tr>
<tr>
<td><code>search_results</code></td>
<td><code>List[models.ScoredPoint]</code></td>
<td>Required</td>
<td>Search results</td>
</tr>
<tr>
<td><code>system_prompt</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>System prompt (uses default if None)</td>
</tr>
</tbody>
</table>
<h4 id="returns_10">Returns<a class="headerlink" href="#returns_10" title="Permanent link">¶</a></h4>
<p><code>str</code> - Complete RAG context string</p>
<h3 id="search_and_create_rag_contextuser_query-limit5-kwargs"><code>search_and_create_rag_context(user_query, limit=5, **kwargs)</code><a class="headerlink" href="#search_and_create_rag_contextuser_query-limit5-kwargs" title="Permanent link">¶</a></h3>
<p>Search for quotes and create RAG context in one convenient method.</p>
<h4 id="parameters_11">Parameters<a class="headerlink" href="#parameters_11" title="Permanent link">¶</a></h4>
<p>Combines parameters from <code>search()</code> and <code>create_rag_context()</code> methods.</p>
<h4 id="returns_11">Returns<a class="headerlink" href="#returns_11" title="Permanent link">¶</a></h4>
<p><code>str</code> - Complete RAG context string</p>
<h2 id="private-methods">🔒 Private Methods<a class="headerlink" href="#private-methods" title="Permanent link">¶</a></h2>
<h3 id="_load_system_prompt"><code>_load_system_prompt()</code><a class="headerlink" href="#_load_system_prompt" title="Permanent link">¶</a></h3>
<p>Load the AI system prompt from external configuration file.</p>
<h4 id="returns_12">Returns<a class="headerlink" href="#returns_12" title="Permanent link">¶</a></h4>
<p><code>str</code> - The system prompt text for RAG operations, or empty string if unavailable</p>
<h3 id="_apply_metadata_filtersresults-author_filternone-category_filternone"><code>_apply_metadata_filters(results, author_filter=None, category_filter=None)</code><a class="headerlink" href="#_apply_metadata_filtersresults-author_filternone-category_filternone" title="Permanent link">¶</a></h3>
<p>Apply author and/or category filters to search results.</p>
<h4 id="parameters_12">Parameters<a class="headerlink" href="#parameters_12" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>results</code></td>
<td><code>List[models.ScoredPoint]</code></td>
<td>Required</td>
<td>List of scored points from vector search</td>
</tr>
<tr>
<td><code>author_filter</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Optional author name to filter by</td>
</tr>
<tr>
<td><code>category_filter</code></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Optional category name to filter by</td>
</tr>
</tbody>
</table>
<h4 id="returns_13">Returns<a class="headerlink" href="#returns_13" title="Permanent link">¶</a></h4>
<p><code>List[models.ScoredPoint]</code> - Filtered list of scored points</p>
<h3 id="_display_search_results_simpleresults-search_description-max_text_length"><code>_display_search_results_simple(results, search_description, max_text_length)</code><a class="headerlink" href="#_display_search_results_simpleresults-search_description-max_text_length" title="Permanent link">¶</a></h3>
<p>Simple fallback display method when Rich library is not available.</p>
<h3 id="_display_llm_response_simpleresponse-user_query"><code>_display_llm_response_simple(response, user_query)</code><a class="headerlink" href="#_display_llm_response_simpleresponse-user_query" title="Permanent link">¶</a></h3>
<p>Simple fallback display method for LLM responses when Rich is not available.</p>
<h2 id="class-attributes">📝 Class Attributes<a class="headerlink" href="#class-attributes" title="Permanent link">¶</a></h2>
<h3 id="system_prompt_path"><code>SYSTEM_PROMPT_PATH</code><a class="headerlink" href="#system_prompt_path" title="Permanent link">¶</a></h3>
<p><code>Path</code> - Path to the external system prompt file for RAG operations.</p>
<p>Default: <code>Path(__file__).parent / "prompts" / "animals_system_prompt.md"</code></p>
<h3 id="animals_rag_system_prompt"><code>ANIMALS_RAG_SYSTEM_PROMPT</code><a class="headerlink" href="#animals_rag_system_prompt" title="Permanent link">¶</a></h3>
<p><code>str</code> - Comprehensive RAG system prompt for Animals class (loaded at init time).</p>
<h3 id="simple_animals_prompt"><code>SIMPLE_ANIMALS_PROMPT</code><a class="headerlink" href="#simple_animals_prompt" title="Permanent link">¶</a></h3>
<p><code>str</code> - Alternative shorter version for quick use:</p>
<div class="highlight"><pre><span></span><code><span class="n">SIMPLE_ANIMALS_PROMPT</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">You are an expert on animal wisdom and quotes. Use the provided search results </span>
<span class="s2">to answer questions about animals, human-animal relationships, and life lessons. </span>
<span class="s2">Always attribute quotes to their authors and explain their relevance to the user's question. </span>
<span class="s2">Be conversational, thoughtful, and helpful in connecting users with the wisdom </span>
<span class="s2">found in animal quotes throughout history.</span>
<span class="s2">"""</span>
</code></pre></div>
<h2 id="use-cases">🎯 Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Educational Chatbots</strong>: AI tutors with grounded animal knowledge</li>
<li><strong>Research Tools</strong>: Explore themes in animal-related literature</li>
<li><strong>Content Generation</strong>: Source-backed articles and presentations</li>
<li><strong>Interactive Learning</strong>: Question-answer systems for students</li>
<li><strong>Philosophical Exploration</strong>: Deep dives into animal wisdom and ethics</li>
</ul>
<h2 id="dependencies">🔗 Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">¶</a></h2>
<p>The Animals class integrates with several other framework components:</p>
<ul>
<li><strong><code>SemanticSearch</code></strong>: Core search functionality</li>
<li><strong><code>EmbeddedVectorDB</code></strong>: Vector storage and retrieval</li>
<li><strong><code>SimpleTextEmbedder</code></strong>: Text embedding generation</li>
<li><strong><code>AnimalQuote</code></strong> and <strong><code>AnimalWisdom</code></strong>: Data models</li>
<li><strong>OpenAI</strong>: LLM integration via instructor</li>
<li><strong>Rich</strong>: Beautiful terminal output</li>
<li><strong>Loguru</strong>: Comprehensive logging</li>
</ul>
<h2 id="source-code">📚 Source Code<a class="headerlink" href="#source-code" title="Permanent link">¶</a></h2>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals">
<code>rag_to_riches.corpus.animals.Animals</code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>A powerful, intelligent corpus loader for animal quotes with RAG capabilities.</p>
<p>This class provides a complete solution for working with collections of animal quotes,
offering semantic search, AI-powered question answering, and beautiful result display.
Perfect for educational applications, research, or building chatbots that need access
to animal wisdom and quotes.</p>
<details class="key-features" open="">
<summary>Key Features</summary>
<ul>
<li>Load quotes from JSONL files with automatic validation</li>
<li>Semantic search using state-of-the-art embeddings</li>
<li>Filter by author, category, or similarity score</li>
<li>AI-powered question answering with GPT models</li>
<li>Beautiful formatted output with Rich library</li>
<li>Complete RAG (Retrieval-Augmented Generation) pipeline</li>
<li>Batch operations for efficiency</li>
</ul>
</details>
<details class="typical-workflow" open="">
<summary>Typical Workflow</summary>
<ol>
<li>Initialize with a vector database</li>
<li>Load quotes from a JSONL file</li>
<li>Index quotes for semantic search</li>
<li>Search for relevant quotes</li>
<li>Ask AI questions about the quotes</li>
</ol>
</details>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rag_to_riches.vectordb.embedded_vectordb</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmbeddedVectorDB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rag_to_riches.corpus.animals</span><span class="w"> </span><span class="kn">import</span> <span class="n">Animals</span>

<span class="c1"># Initialize</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">EmbeddedVectorDB</span><span class="p">()</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s2">"my_quotes"</span><span class="p">)</span>

<span class="c1"># Load and index quotes</span>
<span class="n">quotes_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"data/animal_quotes.jsonl"</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">load_and_index</span><span class="p">(</span><span class="n">quotes_file</span><span class="p">)</span>

<span class="c1"># Search for quotes</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"wisdom about dogs"</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Ask AI a question</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">ask_llm</span><span class="p">(</span><span class="s2">"What do animals teach us about loyalty?"</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">display_llm_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">"loyalty question"</span><span class="p">)</span>
</code></pre></div>
</details>
<p><span class="doc-section-title">Attributes:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code><span title="rag_to_riches.corpus.animals.Animals.embedder">embedder</span></code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>Text embedding model for vector representations</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="rag_to_riches.corpus.animals.Animals.collection_name">collection_name</span></code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>Name of the Qdrant collection storing the quotes</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="rag_to_riches.corpus.animals.Animals.wisdom">wisdom</span></code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" href="../AnimalWisdom/#rag_to_riches.corpus.data_models.AnimalWisdom" title="rag_to_riches.corpus.data_models.AnimalWisdom">AnimalWisdom</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Loaded collection of animal quotes (None until loaded)</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="rag_to_riches.corpus.animals.Animals.semantic_search">semantic_search</span></code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>Underlying search engine for similarity queries</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Animals</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A powerful, intelligent corpus loader for animal quotes with RAG capabilities.</span>

<span class="sd">    This class provides a complete solution for working with collections of animal quotes,</span>
<span class="sd">    offering semantic search, AI-powered question answering, and beautiful result display.</span>
<span class="sd">    Perfect for educational applications, research, or building chatbots that need access</span>
<span class="sd">    to animal wisdom and quotes.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Load quotes from JSONL files with automatic validation</span>
<span class="sd">        - Semantic search using state-of-the-art embeddings</span>
<span class="sd">        - Filter by author, category, or similarity score</span>
<span class="sd">        - AI-powered question answering with GPT models</span>
<span class="sd">        - Beautiful formatted output with Rich library</span>
<span class="sd">        - Complete RAG (Retrieval-Augmented Generation) pipeline</span>
<span class="sd">        - Batch operations for efficiency</span>

<span class="sd">    Typical Workflow:</span>
<span class="sd">        1. Initialize with a vector database</span>
<span class="sd">        2. Load quotes from a JSONL file</span>
<span class="sd">        3. Index quotes for semantic search</span>
<span class="sd">        4. Search for relevant quotes</span>
<span class="sd">        5. Ask AI questions about the quotes</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        from pathlib import Path</span>
<span class="sd">        from rag_to_riches.vectordb.embedded_vectordb import EmbeddedVectorDB</span>
<span class="sd">        from rag_to_riches.corpus.animals import Animals</span>

<span class="sd">        # Initialize</span>
<span class="sd">        vector_db = EmbeddedVectorDB()</span>
<span class="sd">        animals = Animals(vector_db, collection_name="my_quotes")</span>

<span class="sd">        # Load and index quotes</span>
<span class="sd">        quotes_file = Path("data/animal_quotes.jsonl")</span>
<span class="sd">        animals.load_and_index(quotes_file)</span>

<span class="sd">        # Search for quotes</span>
<span class="sd">        results = animals.search("wisdom about dogs", limit=5)</span>

<span class="sd">        # Ask AI a question</span>
<span class="sd">        response = animals.ask_llm("What do animals teach us about loyalty?")</span>
<span class="sd">        animals.display_llm_response(response, "loyalty question")</span>
<span class="sd">        ```</span>

<span class="sd">    Attributes:</span>
<span class="sd">        embedder: Text embedding model for vector representations</span>
<span class="sd">        collection_name: Name of the Qdrant collection storing the quotes</span>
<span class="sd">        wisdom: Loaded collection of animal quotes (None until loaded)</span>
<span class="sd">        semantic_search: Underlying search engine for similarity queries</span>
<span class="sd">    """</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Constructor</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vector_db</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">EmbeddedVectorDB</span><span class="p">),</span>
             <span class="s2">"Vector DB must be an EmbeddedVectorDB instance"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">embedder</span><span class="p">:</span> <span class="n">embedder</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">embedder</span><span class="p">,</span> <span class="n">SimpleTextEmbedder</span><span class="p">),</span>
             <span class="s2">"Embedder must be None or a SimpleTextEmbedder instance"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_db</span><span class="p">:</span> <span class="n">EmbeddedVectorDB</span><span class="p">,</span> 
                 <span class="n">embedder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleTextEmbedder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"animals"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initialize your Animals quote corpus with intelligent search capabilities.</span>

<span class="sd">        Sets up the complete infrastructure for loading, indexing, and searching animal</span>
<span class="sd">        quotes. The system uses advanced sentence transformers for semantic understanding</span>
<span class="sd">        and can work with any size collection efficiently.</span>

<span class="sd">        Args:</span>
<span class="sd">            vector_db: Your vector database instance where quotes will be stored.</span>
<span class="sd">                This handles all the vector storage and retrieval operations.</span>
<span class="sd">            embedder: Optional text embedding model. If None, uses the default</span>
<span class="sd">                'sentence-transformers/all-MiniLM-L6-v2' model which provides</span>
<span class="sd">                excellent semantic understanding for quotes and wisdom.</span>
<span class="sd">            collection_name: Unique name for your quote collection. Use descriptive</span>
<span class="sd">                names like "animal_wisdom", "pet_quotes", or "nature_sayings" to</span>
<span class="sd">                organize multiple collections.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Basic setup with default embedder</span>
<span class="sd">            animals = Animals(vector_db)</span>

<span class="sd">            # Custom setup with specific collection</span>
<span class="sd">            animals = Animals(</span>
<span class="sd">                vector_db=my_db,</span>
<span class="sd">                collection_name="philosophical_animal_quotes"</span>
<span class="sd">            )</span>

<span class="sd">            # Advanced setup with custom embedder</span>
<span class="sd">            custom_embedder = SimpleTextEmbedder(model_name="custom-model")</span>
<span class="sd">            animals = Animals(vector_db, embedder=custom_embedder)</span>
<span class="sd">            ```</span>

<span class="sd">        Note:</span>
<span class="sd">            The constructor automatically loads the RAG system prompt for AI interactions.</span>
<span class="sd">            If the prompt file is missing, a warning is logged but the system continues</span>
<span class="sd">            to work with reduced AI capabilities.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">embedder</span> <span class="ow">or</span> <span class="n">SimpleTextEmbedder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnimalWisdom</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Initialize the underlying semantic search engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span> <span class="o">=</span> <span class="n">SemanticSearch</span><span class="p">(</span>
            <span class="n">embedder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span>
            <span class="n">vector_db</span><span class="o">=</span><span class="n">vector_db</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Initialized Animals corpus loader for collection '</span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Animals</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span><span class="p">:</span>
            <span class="n">Animals</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_system_prompt</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_system_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load the AI system prompt from external configuration file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The system prompt text for RAG operations, or empty string if unavailable.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Animals</span><span class="o">.</span><span class="n">SYSTEM_PROMPT_PATH</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Could not load system prompt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">""</span>


    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Load from JSONL</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)),</span>
             <span class="s2">"JSONL path must be a string or Path object"</span><span class="p">)</span>
    <span class="nd">@ensure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">result</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">AnimalWisdom</span><span class="p">),</span>
            <span class="s2">"Must return an AnimalWisdom instance"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_jsonl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnimalWisdom</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load and validate animal quotes from a JSONL (JSON Lines) file.</span>

<span class="sd">        Reads a file where each line contains a JSON object with quote data. The method</span>
<span class="sd">        performs comprehensive validation, skips malformed entries with helpful warnings,</span>
<span class="sd">        and returns a structured collection of quotes ready for indexing and search.</span>

<span class="sd">        Expected JSONL Format:</span>
<span class="sd">            Each line should be a JSON object with these fields:</span>
<span class="sd">            - "text": The actual quote content (required)</span>
<span class="sd">            - "author": Who said or wrote the quote (required)  </span>
<span class="sd">            - "category": Thematic classification like "Wisdom", "Humor" (required)</span>

<span class="sd">        Args:</span>
<span class="sd">            jsonl_path: Path to your JSONL file containing animal quotes.</span>
<span class="sd">                Can be a string path or pathlib.Path object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AnimalWisdom object containing all successfully loaded quotes with</span>
<span class="sd">            convenient methods for filtering and analysis.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: When the specified file doesn't exist at the given path.</span>
<span class="sd">            InvalidPointsError: When no valid quotes are found in the file, indicating</span>
<span class="sd">                format issues or empty content.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Load quotes from file</span>
<span class="sd">            quotes_path = Path("data/animal_wisdom.jsonl")</span>
<span class="sd">            wisdom = animals.load_from_jsonl(quotes_path)</span>

<span class="sd">            print(f"Loaded {len(wisdom)} quotes")</span>
<span class="sd">            print(f"Categories: {wisdom.get_categories()}")</span>
<span class="sd">            print(f"Authors: {wisdom.get_authors()}")</span>

<span class="sd">            # Access individual quotes</span>
<span class="sd">            for quote in wisdom.quotes[:3]:</span>
<span class="sd">                print(f'"{quote.text}" - {quote.author}')</span>
<span class="sd">            ```</span>

<span class="sd">        File Format Example:</span>
<span class="sd">            ```</span>
<span class="sd">            {"text": "Dogs are not our whole life, but they make our lives whole.", "author": "Roger Caras", "category": "Pets and Companionship"}</span>
<span class="sd">            {"text": "The greatness of a nation can be judged by the way its animals are treated.", "author": "Mahatma Gandhi", "category": "Ethics and Compassion"}</span>
<span class="sd">            ```</span>

<span class="sd">        Note:</span>
<span class="sd">            - Empty lines in the file are automatically skipped</span>
<span class="sd">            - Malformed JSON lines generate warnings but don't stop the process</span>
<span class="sd">            - The loaded quotes are stored in self.wisdom for later use</span>
<span class="sd">            - All text fields are automatically stripped of whitespace</span>
<span class="sd">        """</span>
        <span class="n">jsonl_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"JSONL file not found: </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">quotes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Skip empty lines</span>
                        <span class="k">continue</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">quote</span> <span class="o">=</span> <span class="n">AnimalQuote</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">quotes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Skipped invalid line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                        <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">quotes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                    <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"No valid quotes found in </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                    <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="o">=</span> <span class="n">AnimalWisdom</span><span class="p">(</span><span class="n">quotes</span><span class="o">=</span><span class="n">quotes</span><span class="p">,</span> <span class="n">source_file</span><span class="o">=</span><span class="n">jsonl_path</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">quotes</span><span class="p">)</span><span class="si">}</span><span class="s2"> animal quotes from </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to load animal quotes from </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Index All Quotes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s2">"Animal wisdom must be loaded before indexing"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">index_all_quotes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Transform all loaded quotes into searchable vector embeddings.</span>

<span class="sd">        This method takes your loaded quotes and creates high-dimensional vector</span>
<span class="sd">        representations that enable semantic search. The process uses advanced</span>
<span class="sd">        sentence transformers to understand the meaning and context of each quote,</span>
<span class="sd">        not just keyword matching.</span>

<span class="sd">        The indexing process:</span>
<span class="sd">        1. Extracts text content from each quote</span>
<span class="sd">        2. Generates semantic embeddings using the configured model</span>
<span class="sd">        3. Stores vectors in the database with rich metadata</span>
<span class="sd">        4. Creates searchable points for instant retrieval</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of unique point IDs for each indexed quote. These IDs can be used</span>
<span class="sd">            for direct retrieval, debugging, or managing specific quotes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidPointsError: When indexing fails due to embedding errors,</span>
<span class="sd">                database issues, or missing quote data.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Load quotes first</span>
<span class="sd">            wisdom = animals.load_from_jsonl("quotes.jsonl")</span>

<span class="sd">            # Index for semantic search</span>
<span class="sd">            point_ids = animals.index_all_quotes()</span>
<span class="sd">            print(f"Successfully indexed {len(point_ids)} quotes")</span>

<span class="sd">            # Now you can search semantically</span>
<span class="sd">            results = animals.search("loyalty and friendship")</span>
<span class="sd">            ```</span>

<span class="sd">        Performance Notes:</span>
<span class="sd">            - Batch processing is used for efficiency with large collections</span>
<span class="sd">            - Indexing time scales with collection size and model complexity</span>
<span class="sd">            - Typical speed: ~100-500 quotes per second depending on hardware</span>
<span class="sd">            - GPU acceleration automatically used if available</span>

<span class="sd">        Note:</span>
<span class="sd">            You must call load_from_jsonl() before indexing. The method will</span>
<span class="sd">            fail gracefully if no quotes are loaded, providing clear error messages.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="s2">"No animal wisdom loaded. Call load_from_jsonl() first."</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare texts and metadata for batch indexing</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">]</span>
            <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">quote</span><span class="o">.</span><span class="n">to_payload</span><span class="p">()</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">]</span>

            <span class="c1"># Use SemanticSearch's batch indexing capability</span>
            <span class="n">indexed_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">index_all_text</span><span class="p">(</span>
                <span class="n">texts</span><span class="o">=</span><span class="n">texts</span><span class="p">,</span>
                <span class="n">metadata_list</span><span class="o">=</span><span class="n">metadata_list</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully indexed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">indexed_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> animal quotes into collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">indexed_ids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to index animal quotes: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Collection Management</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">recreate_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Completely reset your quote collection with a fresh, empty database.</span>

<span class="sd">        This is a powerful cleanup method that removes all existing quotes and</span>
<span class="sd">        creates a brand new collection. Use this when you need to start over,</span>
<span class="sd">        fix corruption issues, or completely change your quote dataset.</span>

<span class="sd">        What this method does:</span>
<span class="sd">        1. Safely deletes the existing collection if it exists</span>
<span class="sd">        2. Creates a new empty collection with optimal settings</span>
<span class="sd">        3. Clears all loaded quote data from memory</span>
<span class="sd">        4. Prepares the system for fresh data loading</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidPointsError: If the recreation process fails due to database</span>
<span class="sd">                connection issues or permission problems.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Reset everything and start fresh</span>
<span class="sd">            animals.recreate_collection()</span>

<span class="sd">            # Now load new data</span>
<span class="sd">            new_wisdom = animals.load_from_jsonl("updated_quotes.jsonl")</span>
<span class="sd">            animals.index_all_quotes()</span>
<span class="sd">            ```</span>

<span class="sd">        Warning:</span>
<span class="sd">            This operation is irreversible! All existing quotes in the collection</span>
<span class="sd">            will be permanently deleted. Make sure you have backups of important</span>
<span class="sd">            data before calling this method.</span>

<span class="sd">        Use Cases:</span>
<span class="sd">            - Switching to a completely different quote dataset</span>
<span class="sd">            - Fixing corrupted vector data</span>
<span class="sd">            - Changing embedding models (requires reindexing)</span>
<span class="sd">            - Cleaning up test data before production deployment</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Delete existing collection if it exists</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Deleting existing collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>

            <span class="c1"># Create new empty collection</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Creating new empty collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span>
                <span class="n">vector_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_vector_size</span><span class="p">(),</span>
                <span class="n">distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_distance_metric</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="c1"># Clear loaded wisdom data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully recreated empty collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to recreate collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Load and Index</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">AnimalWisdom</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""One-step solution: load quotes from file and make them instantly searchable.</span>

<span class="sd">        This convenience method combines loading and indexing in a single call,</span>
<span class="sd">        perfect for getting up and running quickly. It handles the complete</span>
<span class="sd">        pipeline from raw JSONL file to searchable vector database.</span>

<span class="sd">        Args:</span>
<span class="sd">            jsonl_path: Path to your JSONL file containing animal quotes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - AnimalWisdom: Your loaded and validated quote collection</span>
<span class="sd">            - List[str]: Point IDs for all indexed quotes</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Complete setup in one line</span>
<span class="sd">            wisdom, point_ids = animals.load_and_index("my_quotes.jsonl")</span>

<span class="sd">            print(f"Ready to search {len(wisdom)} quotes!")</span>

<span class="sd">            # Immediately start searching</span>
<span class="sd">            results = animals.search("courage and bravery")</span>
<span class="sd">            ```</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is equivalent to calling load_from_jsonl() followed by</span>
<span class="sd">            index_all_quotes(), but more convenient for common workflows.</span>
<span class="sd">        """</span>
        <span class="n">wisdom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span>
        <span class="n">point_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">wisdom</span><span class="p">,</span> <span class="n">point_ids</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Search Quotes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">author</span><span class="p">:</span> <span class="n">author</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
             <span class="s2">"Author filter must be None or a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">category</span><span class="p">:</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
             <span class="s2">"Category filter must be None or a non-empty string"</span><span class="p">)</span>
    <span class="nd">@ensure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">result</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Must return a list"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
              <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find the most relevant animal quotes using intelligent semantic search.</span>

<span class="sd">        This powerful search method goes beyond simple keyword matching to understand</span>
<span class="sd">        the meaning and context of your query. It finds quotes that are conceptually</span>
<span class="sd">        similar, even if they don't share exact words with your search terms.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Your search question or topic. Use natural language like</span>
<span class="sd">                "what do animals teach us about love?" or "quotes about courage".</span>
<span class="sd">            limit: Maximum number of results to return (default: 10).</span>
<span class="sd">                Higher values give more options but may include less relevant results.</span>
<span class="sd">            score_threshold: Minimum similarity score (0.0-1.0). Only quotes with</span>
<span class="sd">                similarity above this threshold will be returned. Use 0.7+ for</span>
<span class="sd">                highly relevant results, 0.5+ for broader matches.</span>
<span class="sd">            author: Filter results to only include quotes by this specific author.</span>
<span class="sd">                Case-insensitive matching (e.g., "Gandhi" matches "Mahatma Gandhi").</span>
<span class="sd">            category: Filter results to only include quotes from this category.</span>
<span class="sd">                Case-insensitive matching (e.g., "wisdom" matches "Wisdom and Philosophy").</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ScoredPoint objects, each containing:</span>
<span class="sd">            - score: Similarity score (higher = more relevant)</span>
<span class="sd">            - payload: Quote metadata (content, author, category)</span>
<span class="sd">            Results are automatically sorted by relevance (highest scores first).</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidPointsError: When search fails due to database issues or</span>
<span class="sd">                invalid query parameters.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Basic semantic search</span>
<span class="sd">            results = animals.search("loyalty and friendship")</span>

<span class="sd">            # Precise search with high threshold</span>
<span class="sd">            results = animals.search(</span>
<span class="sd">                "courage in difficult times",</span>
<span class="sd">                limit=5,</span>
<span class="sd">                score_threshold=0.8</span>
<span class="sd">            )</span>

<span class="sd">            # Search within specific author's quotes</span>
<span class="sd">            gandhi_quotes = animals.search(</span>
<span class="sd">                "compassion",</span>
<span class="sd">                author="Mahatma Gandhi",</span>
<span class="sd">                limit=3</span>
<span class="sd">            )</span>

<span class="sd">            # Browse by category</span>
<span class="sd">            wisdom_quotes = animals.search(</span>
<span class="sd">                "life lessons",</span>
<span class="sd">                category="Wisdom and Philosophy"</span>
<span class="sd">            )</span>

<span class="sd">            # Process results</span>
<span class="sd">            for result in results:</span>
<span class="sd">                print(f"Score: {result.score:.3f}")</span>
<span class="sd">                print(f"Quote: {result.payload['content']}")</span>
<span class="sd">                print(f"Author: {result.payload['author']}")</span>
<span class="sd">                print("---")</span>
<span class="sd">            ```</span>

<span class="sd">        Search Tips:</span>
<span class="sd">            - Use descriptive phrases rather than single keywords</span>
<span class="sd">            - Try different phrasings if you don't find what you're looking for</span>
<span class="sd">            - Lower the score_threshold to see more diverse results</span>
<span class="sd">            - Combine filters to narrow down to specific types of quotes</span>

<span class="sd">        Performance:</span>
<span class="sd">            - Search is typically very fast (&lt; 100ms for most collections)</span>
<span class="sd">            - Larger collections may take slightly longer but remain responsive</span>
<span class="sd">            - Filtering by author/category happens after vector search for efficiency</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use SemanticSearch for the core search functionality</span>
            <span class="c1"># Request more results than needed to allow for filtering</span>
            <span class="n">search_limit</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">*</span> <span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">author</span> <span class="ow">or</span> <span class="n">category</span><span class="p">)</span> <span class="k">else</span> <span class="n">limit</span>

            <span class="n">initial_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">search_with_text</span><span class="p">(</span>
                <span class="n">query_text</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">search_limit</span><span class="p">,</span>
                <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span>
            <span class="p">)</span>

            <span class="c1"># Apply metadata filters if specified</span>
            <span class="n">filtered_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_metadata_filters</span><span class="p">(</span>
                <span class="n">results</span><span class="o">=</span><span class="n">initial_results</span><span class="p">,</span>
                <span class="n">author_filter</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                <span class="n">category_filter</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>

            <span class="c1"># Limit to requested number of results</span>
            <span class="n">final_results</span> <span class="o">=</span> <span class="n">filtered_results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Animal quotes search for '</span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...' returned </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results"</span>
                       <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">' (filtered by author)'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="s2">"</span>
                       <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">' (filtered by category)'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">final_results</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to search animal quotes: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Get Collection Stats</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get comprehensive statistics and insights about your quote collection.</span>

<span class="sd">        Provides a detailed overview of your collection's size, content diversity,</span>
<span class="sd">        and database status. Perfect for monitoring, debugging, or presenting</span>
<span class="sd">        collection metrics to users.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing detailed statistics:</span>
<span class="sd">            - collection_name: Name of your quote collection</span>
<span class="sd">            - collection_exists: Whether the database collection exists</span>
<span class="sd">            - point_count: Total quotes stored in the database</span>
<span class="sd">            - loaded_quotes: Number of quotes currently loaded in memory</span>
<span class="sd">            - categories: List of all unique quote categories (sorted)</span>
<span class="sd">            - authors: List of all unique authors (sorted)</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            stats = animals.get_collection_stats()</span>

<span class="sd">            print(f"Collection: {stats['collection_name']}")</span>
<span class="sd">            print(f"Total quotes in database: {stats['point_count']}")</span>
<span class="sd">            print(f"Quotes loaded in memory: {stats['loaded_quotes']}")</span>
<span class="sd">            print(f"Categories ({len(stats['categories'])}): {stats['categories']}")</span>
<span class="sd">            print(f"Authors ({len(stats['authors'])}): {stats['authors'][:5]}...")</span>

<span class="sd">            # Check if ready for search</span>
<span class="sd">            if stats['collection_exists'] and stats['point_count'] &gt; 0:</span>
<span class="sd">                print("✅ Ready for semantic search!")</span>
<span class="sd">            else:</span>
<span class="sd">                print("❌ Need to load and index quotes first")</span>
<span class="sd">            ```</span>

<span class="sd">        Use Cases:</span>
<span class="sd">            - Verify successful data loading and indexing</span>
<span class="sd">            - Display collection overview in user interfaces</span>
<span class="sd">            - Debug database connectivity issues</span>
<span class="sd">            - Monitor collection growth over time</span>
<span class="sd">            - Validate data integrity after operations</span>
<span class="sd">        """</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"collection_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="s2">"collection_exists"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">),</span>
            <span class="s2">"point_count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"loaded_quotes"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"categories"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"authors"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"collection_exists"</span><span class="p">]:</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"point_count"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">count_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"loaded_quotes"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_categories</span><span class="p">()</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"authors"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_authors</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Additional SemanticSearch Integration</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">consistency_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Verify that your database collection is properly configured and ready to use.</span>

<span class="sd">        Performs a comprehensive health check to ensure your collection's vector</span>
<span class="sd">        dimensions, distance metrics, and other parameters match your embedding model.</span>
<span class="sd">        This prevents subtle bugs that could cause poor search results or errors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if everything is properly configured and ready for search operations.</span>
<span class="sd">            False indicates configuration mismatches that need attention.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            if animals.consistency_check():</span>
<span class="sd">                print("✅ Collection is healthy and ready!")</span>
<span class="sd">                results = animals.search("your query here")</span>
<span class="sd">            else:</span>
<span class="sd">                print("❌ Configuration issues detected")</span>
<span class="sd">                print("Consider recreating the collection:")</span>
<span class="sd">                animals.recreate_collection()</span>
<span class="sd">            ```</span>

<span class="sd">        What's Checked:</span>
<span class="sd">            - Vector dimensions match between collection and embedder</span>
<span class="sd">            - Distance metric compatibility</span>
<span class="sd">            - Collection existence and accessibility</span>
<span class="sd">            - Basic connectivity to the vector database</span>

<span class="sd">        Use Cases:</span>
<span class="sd">            - Troubleshooting search performance issues</span>
<span class="sd">            - Validating setup after configuration changes</span>
<span class="sd">            - Health checks in production systems</span>
<span class="sd">            - Debugging after model or database updates</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">consistency_check</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_single_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quote</span><span class="p">:</span> <span class="n">AnimalQuote</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Index a single animal quote.</span>

<span class="sd">        Args:</span>
<span class="sd">            quote: AnimalQuote instance to index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Point ID of the indexed quote.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">index_text</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">quote</span><span class="o">.</span><span class="n">to_payload</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  RAG System Prompts</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1"># Path to the external system prompt file</span>
    <span class="n">SYSTEM_PROMPT_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"prompts"</span> <span class="o">/</span> <span class="s2">"animals_system_prompt.md"</span>

    <span class="c1"># Comprehensive RAG System Prompt for Animals Class (loaded at init time)</span>
    <span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="c1"># Alternative shorter version for quick use</span>
    <span class="n">SIMPLE_ANIMALS_PROMPT</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    You are an expert on animal wisdom and quotes. Use the provided search results </span>
<span class="s2">    to answer questions about animals, human-animal relationships, and life lessons. </span>
<span class="s2">    Always attribute quotes to their authors and explain their relevance to the user's question. </span>
<span class="s2">    Be conversational, thoughtful, and helpful in connecting users with the wisdom </span>
<span class="s2">    found in animal quotes throughout history.</span>
<span class="s2">    """</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  RAG Helper Methods</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Search results must be a list"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_results</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Max results must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_search_results_for_rag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                                     <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Format search results from Animals class for RAG system prompt.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_results: List of ScoredPoint objects from animals.search()</span>
<span class="sd">            max_results: Maximum number of results to include</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted string for RAG context</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"No relevant quotes found for this query."</span>

        <span class="n">formatted_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_results</span><span class="p">[:</span><span class="n">max_results</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span>

            <span class="n">formatted_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"""</span>
<span class="s2">Quote </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: "</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">"</span>
<span class="s2">Author: </span><span class="si">{</span><span class="n">author</span><span class="si">}</span>
<span class="s2">Category: </span><span class="si">{</span><span class="n">category</span><span class="si">}</span>
<span class="s2">Relevance Score: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span>
<span class="s2">"""</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_results</span><span class="p">)</span>

    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Search results must be a list"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_rag_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">search_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                          <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Create a complete RAG context with system prompt and formatted results.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: The user's question</span>
<span class="sd">            search_results: Search results from animals.search()</span>
<span class="sd">            system_prompt: System prompt to use (defaults to comprehensive prompt)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete RAG context string</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">system_prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">system_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">system_prompt</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"System prompt must be a non-empty string"</span><span class="p">)</span>

        <span class="n">formatted_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_search_results_for_rag</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""</span>
<span class="si">{</span><span class="n">system_prompt</span><span class="si">}</span>

<span class="s2">## User Query</span>
<span class="si">{</span><span class="n">user_query</span><span class="si">}</span>

<span class="s2">## Relevant Quotes</span>
<span class="si">{</span><span class="n">formatted_results</span><span class="si">}</span>

<span class="s2">Please answer the user's question using the provided quotes and following the guidelines above.</span>
<span class="s2">"""</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">search_and_create_rag_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                                    <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Search for quotes and create RAG context in one convenient method.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: The user's question</span>
<span class="sd">            limit: Maximum number of search results to include</span>
<span class="sd">            score_threshold: Minimum similarity score threshold</span>
<span class="sd">            author: Optional filter to only return quotes by this author</span>
<span class="sd">            category: Optional filter to only return quotes in this category</span>
<span class="sd">            system_prompt: System prompt to use (defaults to comprehensive prompt)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete RAG context string</span>
<span class="sd">        """</span>
        <span class="c1"># Search for relevant quotes</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

        <span class="c1"># Create RAG context</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rag_context</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">search_results</span><span class="p">,</span> <span class="n">system_prompt</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  Helper Methods (Private)</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Results must be a list"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_description</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_description</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_description</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Search description must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_text_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_text_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Max text length must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_search_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                              <span class="n">search_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                              <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Present search results in a beautiful, easy-to-read table format.</span>

<span class="sd">        Creates an elegant visual display of your search results using the Rich library</span>
<span class="sd">        for colorful, well-formatted output. Perfect for interactive applications,</span>
<span class="sd">        demos, or any time you want to show results in a professional way.</span>

<span class="sd">        Args:</span>
<span class="sd">            results: Your search results from the search() method. Each result</span>
<span class="sd">                contains the quote text, author, category, and relevance score.</span>
<span class="sd">            search_description: A descriptive title for the search that will be</span>
<span class="sd">                displayed at the top of the table (e.g., "Quotes about loyalty").</span>
<span class="sd">            max_text_length: Maximum characters to display for each quote before</span>
<span class="sd">                truncating with "..." (default: 120). Keeps table readable.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Search and display results beautifully</span>
<span class="sd">            results = animals.search("courage and bravery", limit=5)</span>
<span class="sd">            animals.display_search_results(</span>
<span class="sd">                results, </span>
<span class="sd">                "Quotes about Courage and Bravery",</span>
<span class="sd">                max_text_length=100</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>

<span class="sd">        Output Features:</span>
<span class="sd">            - 🎨 Color-coded columns for easy scanning</span>
<span class="sd">            - 📊 Relevance scores prominently displayed</span>
<span class="sd">            - ✂️ Smart text truncation to maintain readability</span>
<span class="sd">            - 📱 Responsive layout that works in various terminal sizes</span>
<span class="sd">            - 🚫 Graceful handling of empty results</span>

<span class="sd">        Fallback Behavior:</span>
<span class="sd">            If the Rich library isn't available, automatically falls back to</span>
<span class="sd">            simple text output that works in any environment.</span>

<span class="sd">        Use Cases:</span>
<span class="sd">            - Interactive demos and presentations</span>
<span class="sd">            - Development and debugging sessions</span>
<span class="sd">            - Educational tools showing search capabilities</span>
<span class="sd">            - Command-line applications with rich output</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>

            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

            <span class="c1"># Create table</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"🔍 </span><span class="si">{</span><span class="n">search_description</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">header_style</span><span class="o">=</span><span class="s2">"bold magenta"</span><span class="p">,</span>
                <span class="n">border_style</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
                <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Add significant vertical and horizontal padding</span>
            <span class="p">)</span>

            <span class="c1"># Add columns</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"center"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Score"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"center"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Quote"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bright_white"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Author"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bold bright_yellow"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Category"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"❌ No results found."</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Add rows</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="n">author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
                <span class="n">category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span>

                <span class="c1"># Truncate long quotes for readability</span>
                <span class="n">display_content</span> <span class="o">=</span> <span class="p">(</span><span class="n">content</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_text_length</span> 
                                 <span class="k">else</span> <span class="n">content</span><span class="p">[:</span><span class="n">max_text_length</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"..."</span><span class="p">)</span>

                <span class="c1"># Create styled text for quote</span>
                <span class="n">quote_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">display_content</span><span class="si">}</span><span class="s1">"'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">)</span>

                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                    <span class="n">quote_text</span><span class="p">,</span>
                    <span class="n">author</span><span class="p">,</span>
                    <span class="n">category</span>
                <span class="p">)</span>

            <span class="c1"># Display table</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"📊 Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bold green"</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># Fallback to simple print if rich is not available</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Rich library not available, falling back to simple display"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_search_results_simple</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">search_description</span><span class="p">,</span> <span class="n">max_text_length</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to display search results: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="c1"># Fallback to simple display</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_search_results_simple</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">search_description</span><span class="p">,</span> <span class="n">max_text_length</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_display_search_results_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                                      <span class="n">search_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                                      <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Simple fallback display method when rich is not available.</span>

<span class="sd">        Args:</span>
<span class="sd">            results: List of ScoredPoint objects from search results.</span>
<span class="sd">            search_description: Description of the search to display.</span>
<span class="sd">            max_text_length: Maximum length for quote text before truncation.</span>
<span class="sd">        """</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">🔍 </span><span class="si">{</span><span class="n">search_description</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="sa">f</span><span class="s2">"🔍 </span><span class="si">{</span><span class="n">search_description</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"   ❌ No results found."</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   📊 Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>

            <span class="c1"># Truncate long quotes for readability</span>
            <span class="n">display_content</span> <span class="o">=</span> <span class="p">(</span><span class="n">content</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_text_length</span> 
                             <span class="k">else</span> <span class="n">content</span><span class="p">[:</span><span class="n">max_text_length</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"..."</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. 📊 Score: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"      💬 Quote: </span><span class="se">\"</span><span class="si">{</span><span class="n">display_content</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"      ✍️  Author: </span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"      🏷️  Category: </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_metadata_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span>
                               <span class="n">author_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">category_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Apply author and/or category filters to search results.</span>

<span class="sd">        Args:</span>
<span class="sd">            results: List of scored points from vector search.</span>
<span class="sd">            author_filter: Optional author name to filter by.</span>
<span class="sd">            category_filter: Optional category name to filter by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filtered list of scored points.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">author_filter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">category_filter</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="c1"># Skip results without payload</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Apply author filter</span>
            <span class="k">if</span> <span class="n">author_filter</span><span class="p">:</span>
                <span class="n">result_author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result_author</span> <span class="ow">or</span> <span class="n">result_author</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">author_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">continue</span>

            <span class="c1"># Apply category filter</span>
            <span class="k">if</span> <span class="n">category_filter</span><span class="p">:</span>
                <span class="n">result_category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result_category</span> <span class="ow">or</span> <span class="n">result_category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">category_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">continue</span>

            <span class="n">filtered_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_results</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  LLM Response Models</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">AnimalWisdomResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Structured response from LLM about animal wisdom."""</span>

        <span class="n">answer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
            <span class="o">...</span><span class="p">,</span> 
            <span class="n">description</span><span class="o">=</span><span class="s2">"A thoughtful answer to the user's question about animals, using the provided quotes"</span>
        <span class="p">)</span>
        <span class="n">key_insights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
            <span class="o">...</span><span class="p">,</span> 
            <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"2-5 key insights or themes from the quotes"</span>
        <span class="p">)</span>
        <span class="n">recommended_quotes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
            <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Specific quotes that are most relevant to the answer (with author attribution)"</span>
        <span class="p">)</span>
        <span class="n">follow_up_questions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
            <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"2-3 follow-up questions to explore related topics"</span>
        <span class="p">)</span>

        <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">'answer'</span><span class="p">)</span>
        <span class="nd">@classmethod</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">validate_answer_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Ensure answer is substantial."""</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Answer must be at least 50 characters long"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  LLM Integration Methods</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ask_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnimalWisdomResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Ask AI thoughtful questions about animals and get structured, insightful answers.</span>

<span class="sd">        This method combines the power of semantic search with advanced AI reasoning</span>
<span class="sd">        to provide comprehensive answers about animal wisdom, behavior, and human-animal</span>
<span class="sd">        relationships. The AI draws from your quote collection to give contextual,</span>
<span class="sd">        well-sourced responses.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: Your question about animals. Can be philosophical ("What do</span>
<span class="sd">                animals teach us about love?"), practical ("How do pets help humans?"),</span>
<span class="sd">                or exploratory ("What wisdom comes from observing nature?").</span>
<span class="sd">            limit: Number of relevant quotes to provide as context (default: 5).</span>
<span class="sd">                More quotes give richer context but may slow response time.</span>
<span class="sd">            score_threshold: Only use quotes above this similarity score (0.0-1.0).</span>
<span class="sd">                Higher values ensure more relevant context for better answers.</span>
<span class="sd">            author: Focus the answer on quotes from this specific author only.</span>
<span class="sd">            category: Limit context to quotes from this category only.</span>
<span class="sd">            model: OpenAI model to use. "gpt-4o" (default) provides the most</span>
<span class="sd">                thoughtful responses, "gpt-3.5-turbo" is faster and cheaper.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AnimalWisdomResponse containing:</span>
<span class="sd">            - answer: Comprehensive, thoughtful response to your question</span>
<span class="sd">            - key_insights: 2-5 main themes or takeaways from the analysis</span>
<span class="sd">            - recommended_quotes: Most relevant quotes with proper attribution</span>
<span class="sd">            - follow_up_questions: Suggested related questions to explore further</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Ask a philosophical question</span>
<span class="sd">            response = animals.ask_llm(</span>
<span class="sd">                "What can animals teach us about resilience and survival?"</span>
<span class="sd">            )</span>

<span class="sd">            # Display the structured response</span>
<span class="sd">            animals.display_llm_response(response, "resilience question")</span>

<span class="sd">            # Access specific parts</span>
<span class="sd">            print("Main Answer:")</span>
<span class="sd">            print(response.answer)</span>

<span class="sd">            print("\\nKey Insights:")</span>
<span class="sd">            for insight in response.key_insights:</span>
<span class="sd">                print(f"- {insight}")</span>

<span class="sd">            # Ask follow-up questions</span>
<span class="sd">            for question in response.follow_up_questions:</span>
<span class="sd">                print(f"Next: {question}")</span>
<span class="sd">            ```</span>

<span class="sd">        Question Ideas:</span>
<span class="sd">            - "How do animals demonstrate unconditional love?"</span>
<span class="sd">            - "What survival strategies can humans learn from animals?"</span>
<span class="sd">            - "How do different cultures view human-animal relationships?"</span>
<span class="sd">            - "What role do animals play in teaching empathy?"</span>

<span class="sd">        Note:</span>
<span class="sd">            Requires OpenAI API key in environment. The AI uses your indexed quotes</span>
<span class="sd">            as primary sources, ensuring answers are grounded in your collection</span>
<span class="sd">            rather than general knowledge alone.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create RAG context</span>
            <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_create_rag_context</span><span class="p">(</span>
                <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>

            <span class="c1"># Create instructor-patched client</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">instructor</span><span class="o">.</span><span class="n">from_openai</span><span class="p">(</span><span class="n">OpenAI</span><span class="p">())</span>

            <span class="c1"># Get structured response from LLM</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnimalWisdomResponse</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">}</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LLM response generated for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...'"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to get LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"LLM query failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ask_llm_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                      <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get a simple text response from the LLM about animals.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: The user's question about animals</span>
<span class="sd">            limit: Maximum number of search results to include</span>
<span class="sd">            model: OpenAI model to use (default: gpt-4o)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Simple text response from the LLM</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create RAG context</span>
            <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_create_rag_context</span><span class="p">(</span>
                <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
            <span class="p">)</span>

            <span class="c1"># Create OpenAI client</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">()</span>

            <span class="c1"># Get simple response from LLM</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">}</span>
                <span class="p">],</span>
                <span class="n">max_tokens</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>

            <span class="n">answer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Simple LLM response generated for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...'"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">answer</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to get simple LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Simple LLM query failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_llm_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">AnimalWisdomResponse</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Display the LLM response in a formatted way using rich.</span>

<span class="sd">        Args:</span>
<span class="sd">            response: The structured response from the LLM</span>
<span class="sd">            user_query: The original user query</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">rich.columns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Columns</span>

            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

            <span class="c1"># Display the main answer</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                <span class="n">Text</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">answer</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"white"</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"🤖 LLM Answer to: '</span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span><span class="s2">'"</span><span class="p">,</span>
                <span class="n">border_style</span><span class="o">=</span><span class="s2">"green"</span>
            <span class="p">))</span>

            <span class="c1"># Display key insights</span>
            <span class="n">insights_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"• </span><span class="si">{</span><span class="n">insight</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">insight</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">key_insights</span><span class="p">])</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                <span class="n">Text</span><span class="p">(</span><span class="n">insights_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">"💡 Key Insights"</span><span class="p">,</span>
                <span class="n">border_style</span><span class="o">=</span><span class="s2">"blue"</span>
            <span class="p">))</span>

            <span class="c1"># Display recommended quotes</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">:</span>
                <span class="n">quotes_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"💬 </span><span class="si">{</span><span class="n">quote</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">])</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                    <span class="n">Text</span><span class="p">(</span><span class="n">quotes_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">),</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">"📚 Recommended Quotes"</span><span class="p">,</span>
                    <span class="n">border_style</span><span class="o">=</span><span class="s2">"yellow"</span>
                <span class="p">))</span>

            <span class="c1"># Display follow-up questions</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
                <span class="n">questions_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"❓ </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">])</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                    <span class="n">Text</span><span class="p">(</span><span class="n">questions_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">),</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">"🔍 Follow-up Questions"</span><span class="p">,</span>
                    <span class="n">border_style</span><span class="o">=</span><span class="s2">"magenta"</span>
                <span class="p">))</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># Fallback to simple print if rich is not available</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Rich library not available, falling back to simple display"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_llm_response_simple</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">user_query</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to display LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_llm_response_simple</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">user_query</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_display_llm_response_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">AnimalWisdomResponse</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Simple fallback display method when rich is not available.</span>

<span class="sd">        Args:</span>
<span class="sd">            response: The structured response from the LLM</span>
<span class="sd">            user_query: The original user query</span>
<span class="sd">        """</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">🤖 LLM Answer to: '</span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">"💡 Key Insights:"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">insight</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">key_insights</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  • </span><span class="si">{</span><span class="n">insight</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"📚 Recommended Quotes:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  💬 </span><span class="si">{</span><span class="n">quote</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"🔍 Follow-up Questions:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  ❓ </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="c1">#  RAG Facade Method</span>
    <span class="c1"># ----------------------------------------------------------------------------------------</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">,</span>
            <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"structured"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""🚀 Complete AI-powered question answering in one powerful method call.</span>

<span class="sd">        This is your one-stop solution for getting intelligent answers about animals.</span>
<span class="sd">        It automatically searches your quote collection, finds the most relevant content,</span>
<span class="sd">        and generates comprehensive AI responses with full transparency into the process.</span>

<span class="sd">        Perfect for building chatbots, educational tools, or research applications where</span>
<span class="sd">        you need both the AI answer and access to the underlying source material.</span>

<span class="sd">        The Complete RAG Pipeline:</span>
<span class="sd">        1. 🔍 Semantic search finds relevant quotes from your collection</span>
<span class="sd">        2. 📝 Context generation creates optimized prompts for the AI</span>
<span class="sd">        3. 🤖 AI reasoning produces thoughtful, grounded responses</span>
<span class="sd">        4. 📊 Full transparency with all intermediate results returned</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: Your question about animals. Use natural, conversational</span>
<span class="sd">                language like "How do animals show love?" or "What can pets teach</span>
<span class="sd">                children about responsibility?"</span>
<span class="sd">            limit: Number of quotes to use as context (default: 5). More context</span>
<span class="sd">                can improve answer quality but increases cost and response time.</span>
<span class="sd">            score_threshold: Minimum relevance score for quotes (0.0-1.0). Higher</span>
<span class="sd">                values ensure only highly relevant quotes are used as context.</span>
<span class="sd">            author: Limit context to quotes from this author only. Great for</span>
<span class="sd">                exploring specific perspectives or philosophies.</span>
<span class="sd">            category: Focus on quotes from this category only. Useful for domain-</span>
<span class="sd">                specific questions like "Ethics" or "Pet Care".</span>
<span class="sd">            model: OpenAI model for AI responses. "gpt-4o" gives the best quality,</span>
<span class="sd">                "gpt-3.5-turbo" is faster and more economical.</span>
<span class="sd">            response_type: Format of AI response:</span>
<span class="sd">                - "structured": Rich AnimalWisdomResponse with insights and follow-ups</span>
<span class="sd">                - "simple": Plain text response for basic use cases</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete results dictionary containing:</span>
<span class="sd">            - llm_response: AI answer (structured object or simple string)</span>
<span class="sd">            - search_results: List of relevant quotes found (with scores)</span>
<span class="sd">            - rag_context: Full prompt sent to AI (for debugging/transparency)</span>
<span class="sd">            - query_info: Metadata about the query and processing parameters</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidPointsError: When any step fails (search, context generation,</span>
<span class="sd">                or AI response). Error messages indicate which step failed.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Complete RAG in one call</span>
<span class="sd">            result = animals.rag(</span>
<span class="sd">                "What do animals teach us about unconditional love?",</span>
<span class="sd">                limit=7,</span>
<span class="sd">                score_threshold=0.6,</span>
<span class="sd">                response_type="structured"</span>
<span class="sd">            )</span>

<span class="sd">            # Access the AI response</span>
<span class="sd">            ai_answer = result["llm_response"]</span>
<span class="sd">            print("AI Answer:", ai_answer.answer)</span>

<span class="sd">            # See what quotes were used</span>
<span class="sd">            quotes_used = result["search_results"]</span>
<span class="sd">            print(f"Based on {len(quotes_used)} relevant quotes")</span>

<span class="sd">            # Inspect the full context (for debugging)</span>
<span class="sd">            full_prompt = result["rag_context"]</span>

<span class="sd">            # Get query metadata</span>
<span class="sd">            info = result["query_info"]</span>
<span class="sd">            print(f"Model: {info['model']}, Results: {info['results_count']}")</span>
<span class="sd">            ```</span>

<span class="sd">        Advanced Usage:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Domain-specific question</span>
<span class="sd">            ethics_result = animals.rag(</span>
<span class="sd">                "How should humans treat wild animals?",</span>
<span class="sd">                category="Ethics and Compassion",</span>
<span class="sd">                limit=10</span>
<span class="sd">            )</span>

<span class="sd">            # Author-focused inquiry</span>
<span class="sd">            gandhi_result = animals.rag(</span>
<span class="sd">                "What did Gandhi believe about animals?",</span>
<span class="sd">                author="Mahatma Gandhi",</span>
<span class="sd">                response_type="simple"</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>

<span class="sd">        Use Cases:</span>
<span class="sd">            - Educational Q&amp;A systems about animals and nature</span>
<span class="sd">            - Research tools for exploring animal-human relationships</span>
<span class="sd">            - Content generation for blogs, articles, or presentations</span>
<span class="sd">            - Interactive chatbots with grounded, source-backed responses</span>
<span class="sd">            - Philosophical exploration of animal wisdom and ethics</span>

<span class="sd">        Performance Tips:</span>
<span class="sd">            - Start with limit=5 for good balance of quality and speed</span>
<span class="sd">            - Use score_threshold=0.7+ for highly focused questions</span>
<span class="sd">            - Choose "simple" response_type for faster, lower-cost interactions</span>
<span class="sd">            - Cache results for frequently asked questions</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Step 1: Perform semantic search</span>
            <span class="n">search_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>

            <span class="c1"># Step 2: Generate RAG context</span>
            <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rag_context</span><span class="p">(</span>
                <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">search_results</span><span class="o">=</span><span class="n">search_results</span>
            <span class="p">)</span>

            <span class="c1"># Step 3: Get LLM response based on type</span>
            <span class="k">if</span> <span class="n">response_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"structured"</span><span class="p">:</span>
                <span class="n">llm_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_llm</span><span class="p">(</span>
                    <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                    <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
                    <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">response_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"simple"</span><span class="p">:</span>
                <span class="n">llm_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_llm_simple</span><span class="p">(</span>
                    <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid response_type: </span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2">. Must be 'structured' or 'simple'"</span><span class="p">)</span>

            <span class="c1"># Step 4: Prepare query info</span>
            <span class="n">query_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"user_query"</span><span class="p">:</span> <span class="n">user_query</span><span class="p">,</span>
                <span class="s2">"limit"</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">"score_threshold"</span><span class="p">:</span> <span class="n">score_threshold</span><span class="p">,</span>
                <span class="s2">"author_filter"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
                <span class="s2">"category_filter"</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                <span class="s2">"response_type"</span><span class="p">:</span> <span class="n">response_type</span><span class="p">,</span>
                <span class="s2">"results_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="c1"># Step 5: Return complete RAG result</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"llm_response"</span><span class="p">:</span> <span class="n">llm_response</span><span class="p">,</span>
                <span class="s2">"search_results"</span><span class="p">:</span> <span class="n">search_results</span><span class="p">,</span>
                <span class="s2">"rag_context"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">,</span>
                <span class="s2">"query_info"</span><span class="p">:</span> <span class="n">query_info</span>
            <span class="p">}</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Complete RAG pipeline executed for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...' "</span>
                       <span class="sa">f</span><span class="s2">"with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results and </span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2"> response"</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"RAG pipeline failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"RAG pipeline failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse">
<code>AnimalWisdomResponse</code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>
<p>Structured response from LLM about animal wisdom.</p>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnimalWisdomResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Structured response from LLM about animal wisdom."""</span>

    <span class="n">answer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> 
        <span class="n">description</span><span class="o">=</span><span class="s2">"A thoughtful answer to the user's question about animals, using the provided quotes"</span>
    <span class="p">)</span>
    <span class="n">key_insights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> 
        <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"2-5 key insights or themes from the quotes"</span>
    <span class="p">)</span>
    <span class="n">recommended_quotes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Specific quotes that are most relevant to the answer (with author attribution)"</span>
    <span class="p">)</span>
    <span class="n">follow_up_questions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"2-3 follow-up questions to explore related topics"</span>
    <span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">'answer'</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_answer_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Ensure answer is substantial."""</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Answer must be at least 50 characters long"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse.validate_answer_length">
<code class="highlight language-python"><span class="n">validate_answer_length</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse.validate_answer_length" title="Permanent link">¶</a></h4>
<div class="doc doc-contents">
<p>Ensure answer is substantial.</p>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s1">'answer'</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_answer_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Ensure answer is substantial."""</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Answer must be at least 50 characters long"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">'animals'</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.__init__" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Initialize your Animals quote corpus with intelligent search capabilities.</p>
<p>Sets up the complete infrastructure for loading, indexing, and searching animal
quotes. The system uses advanced sentence transformers for semantic understanding
and can work with any size collection efficiently.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>vector_db</code>
</td>
<td>
<code><span title="rag_to_riches.vectordb.embedded_vectordb.EmbeddedVectorDB">EmbeddedVectorDB</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Your vector database instance where quotes will be stored.
This handles all the vector storage and retrieval operations.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>embedder</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="rag_to_riches.vectordb.embedder.SimpleTextEmbedder">SimpleTextEmbedder</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional text embedding model. If None, uses the default
'sentence-transformers/all-MiniLM-L6-v2' model which provides
excellent semantic understanding for quotes and wisdom.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>collection_name</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Unique name for your quote collection. Use descriptive
names like "animal_wisdom", "pet_quotes", or "nature_sayings" to
organize multiple collections.</p>
</div>
</td>
<td>
<code>'animals'</code>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Basic setup with default embedder</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span><span class="n">vector_db</span><span class="p">)</span>

<span class="c1"># Custom setup with specific collection</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span>
    <span class="n">vector_db</span><span class="o">=</span><span class="n">my_db</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">"philosophical_animal_quotes"</span>
<span class="p">)</span>

<span class="c1"># Advanced setup with custom embedder</span>
<span class="n">custom_embedder</span> <span class="o">=</span> <span class="n">SimpleTextEmbedder</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">"custom-model"</span><span class="p">)</span>
<span class="n">animals</span> <span class="o">=</span> <span class="n">Animals</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="n">custom_embedder</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>The constructor automatically loads the RAG system prompt for AI interactions.
If the prompt file is missing, a warning is logged but the system continues
to work with reduced AI capabilities.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vector_db</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_db</span><span class="p">,</span> <span class="n">EmbeddedVectorDB</span><span class="p">),</span>
         <span class="s2">"Vector DB must be an EmbeddedVectorDB instance"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">embedder</span><span class="p">:</span> <span class="n">embedder</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">embedder</span><span class="p">,</span> <span class="n">SimpleTextEmbedder</span><span class="p">),</span>
         <span class="s2">"Embedder must be None or a SimpleTextEmbedder instance"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_db</span><span class="p">:</span> <span class="n">EmbeddedVectorDB</span><span class="p">,</span> 
             <span class="n">embedder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleTextEmbedder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"animals"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Initialize your Animals quote corpus with intelligent search capabilities.</span>

<span class="sd">    Sets up the complete infrastructure for loading, indexing, and searching animal</span>
<span class="sd">    quotes. The system uses advanced sentence transformers for semantic understanding</span>
<span class="sd">    and can work with any size collection efficiently.</span>

<span class="sd">    Args:</span>
<span class="sd">        vector_db: Your vector database instance where quotes will be stored.</span>
<span class="sd">            This handles all the vector storage and retrieval operations.</span>
<span class="sd">        embedder: Optional text embedding model. If None, uses the default</span>
<span class="sd">            'sentence-transformers/all-MiniLM-L6-v2' model which provides</span>
<span class="sd">            excellent semantic understanding for quotes and wisdom.</span>
<span class="sd">        collection_name: Unique name for your quote collection. Use descriptive</span>
<span class="sd">            names like "animal_wisdom", "pet_quotes", or "nature_sayings" to</span>
<span class="sd">            organize multiple collections.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Basic setup with default embedder</span>
<span class="sd">        animals = Animals(vector_db)</span>

<span class="sd">        # Custom setup with specific collection</span>
<span class="sd">        animals = Animals(</span>
<span class="sd">            vector_db=my_db,</span>
<span class="sd">            collection_name="philosophical_animal_quotes"</span>
<span class="sd">        )</span>

<span class="sd">        # Advanced setup with custom embedder</span>
<span class="sd">        custom_embedder = SimpleTextEmbedder(model_name="custom-model")</span>
<span class="sd">        animals = Animals(vector_db, embedder=custom_embedder)</span>
<span class="sd">        ```</span>

<span class="sd">    Note:</span>
<span class="sd">        The constructor automatically loads the RAG system prompt for AI interactions.</span>
<span class="sd">        If the prompt file is missing, a warning is logged but the system continues</span>
<span class="sd">        to work with reduced AI capabilities.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">embedder</span> <span class="ow">or</span> <span class="n">SimpleTextEmbedder</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnimalWisdom</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Initialize the underlying semantic search engine</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span> <span class="o">=</span> <span class="n">SemanticSearch</span><span class="p">(</span>
        <span class="n">embedder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span>
        <span class="n">vector_db</span><span class="o">=</span><span class="n">vector_db</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Initialized Animals corpus loader for collection '</span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Animals</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span><span class="p">:</span>
        <span class="n">Animals</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_system_prompt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.ask_llm">
<code class="highlight language-python"><span class="n">ask_llm</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">'gpt-4o'</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.ask_llm" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Ask AI thoughtful questions about animals and get structured, insightful answers.</p>
<p>This method combines the power of semantic search with advanced AI reasoning
to provide comprehensive answers about animal wisdom, behavior, and human-animal
relationships. The AI draws from your quote collection to give contextual,
well-sourced responses.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Your question about animals. Can be philosophical ("What do
animals teach us about love?"), practical ("How do pets help humans?"),
or exploratory ("What wisdom comes from observing nature?").</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>limit</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Number of relevant quotes to provide as context (default: 5).
More quotes give richer context but may slow response time.</p>
</div>
</td>
<td>
<code>5</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>score_threshold</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Only use quotes above this similarity score (0.0-1.0).
Higher values ensure more relevant context for better answers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>author</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Focus the answer on quotes from this specific author only.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>category</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Limit context to quotes from this category only.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>model</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>OpenAI model to use. "gpt-4o" (default) provides the most
thoughtful responses, "gpt-3.5-turbo" is faster and cheaper.</p>
</div>
</td>
<td>
<code>'gpt-4o'</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<p>AnimalWisdomResponse containing:</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>answer: Comprehensive, thoughtful response to your question</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>key_insights: 2-5 main themes or takeaways from the analysis</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>recommended_quotes: Most relevant quotes with proper attribution</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>follow_up_questions: Suggested related questions to explore further</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Ask a philosophical question</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">ask_llm</span><span class="p">(</span>
    <span class="s2">"What can animals teach us about resilience and survival?"</span>
<span class="p">)</span>

<span class="c1"># Display the structured response</span>
<span class="n">animals</span><span class="o">.</span><span class="n">display_llm_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">"resilience question"</span><span class="p">)</span>

<span class="c1"># Access specific parts</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Main Answer:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Key Insights:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">insight</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">key_insights</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"- </span><span class="si">{</span><span class="n">insight</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Ask follow-up questions</span>
<span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Next: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="question-ideas" open="">
<summary>Question Ideas</summary>
<ul>
<li>"How do animals demonstrate unconditional love?"</li>
<li>"What survival strategies can humans learn from animals?"</li>
<li>"How do different cultures view human-animal relationships?"</li>
<li>"What role do animals play in teaching empathy?"</li>
</ul>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>Requires OpenAI API key in environment. The AI uses your indexed quotes
as primary sources, ensuring answers are grounded in your collection
rather than general knowledge alone.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ask_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnimalWisdomResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Ask AI thoughtful questions about animals and get structured, insightful answers.</span>

<span class="sd">    This method combines the power of semantic search with advanced AI reasoning</span>
<span class="sd">    to provide comprehensive answers about animal wisdom, behavior, and human-animal</span>
<span class="sd">    relationships. The AI draws from your quote collection to give contextual,</span>
<span class="sd">    well-sourced responses.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_query: Your question about animals. Can be philosophical ("What do</span>
<span class="sd">            animals teach us about love?"), practical ("How do pets help humans?"),</span>
<span class="sd">            or exploratory ("What wisdom comes from observing nature?").</span>
<span class="sd">        limit: Number of relevant quotes to provide as context (default: 5).</span>
<span class="sd">            More quotes give richer context but may slow response time.</span>
<span class="sd">        score_threshold: Only use quotes above this similarity score (0.0-1.0).</span>
<span class="sd">            Higher values ensure more relevant context for better answers.</span>
<span class="sd">        author: Focus the answer on quotes from this specific author only.</span>
<span class="sd">        category: Limit context to quotes from this category only.</span>
<span class="sd">        model: OpenAI model to use. "gpt-4o" (default) provides the most</span>
<span class="sd">            thoughtful responses, "gpt-3.5-turbo" is faster and cheaper.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AnimalWisdomResponse containing:</span>
<span class="sd">        - answer: Comprehensive, thoughtful response to your question</span>
<span class="sd">        - key_insights: 2-5 main themes or takeaways from the analysis</span>
<span class="sd">        - recommended_quotes: Most relevant quotes with proper attribution</span>
<span class="sd">        - follow_up_questions: Suggested related questions to explore further</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Ask a philosophical question</span>
<span class="sd">        response = animals.ask_llm(</span>
<span class="sd">            "What can animals teach us about resilience and survival?"</span>
<span class="sd">        )</span>

<span class="sd">        # Display the structured response</span>
<span class="sd">        animals.display_llm_response(response, "resilience question")</span>

<span class="sd">        # Access specific parts</span>
<span class="sd">        print("Main Answer:")</span>
<span class="sd">        print(response.answer)</span>

<span class="sd">        print("\\nKey Insights:")</span>
<span class="sd">        for insight in response.key_insights:</span>
<span class="sd">            print(f"- {insight}")</span>

<span class="sd">        # Ask follow-up questions</span>
<span class="sd">        for question in response.follow_up_questions:</span>
<span class="sd">            print(f"Next: {question}")</span>
<span class="sd">        ```</span>

<span class="sd">    Question Ideas:</span>
<span class="sd">        - "How do animals demonstrate unconditional love?"</span>
<span class="sd">        - "What survival strategies can humans learn from animals?"</span>
<span class="sd">        - "How do different cultures view human-animal relationships?"</span>
<span class="sd">        - "What role do animals play in teaching empathy?"</span>

<span class="sd">    Note:</span>
<span class="sd">        Requires OpenAI API key in environment. The AI uses your indexed quotes</span>
<span class="sd">        as primary sources, ensuring answers are grounded in your collection</span>
<span class="sd">        rather than general knowledge alone.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create RAG context</span>
        <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_create_rag_context</span><span class="p">(</span>
            <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

        <span class="c1"># Create instructor-patched client</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">instructor</span><span class="o">.</span><span class="n">from_openai</span><span class="p">(</span><span class="n">OpenAI</span><span class="p">())</span>

        <span class="c1"># Get structured response from LLM</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnimalWisdomResponse</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LLM response generated for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...'"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to get LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"LLM query failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.ask_llm_simple">
<code class="highlight language-python"><span class="n">ask_llm_simple</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">'gpt-4o'</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.ask_llm_simple" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Get a simple text response from the LLM about animals.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The user's question about animals</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>limit</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of search results to include</p>
</div>
</td>
<td>
<code>3</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>model</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>OpenAI model to use (default: gpt-4o)</p>
</div>
</td>
<td>
<code>'gpt-4o'</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Simple text response from the LLM</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ask_llm_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                  <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Get a simple text response from the LLM about animals.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_query: The user's question about animals</span>
<span class="sd">        limit: Maximum number of search results to include</span>
<span class="sd">        model: OpenAI model to use (default: gpt-4o)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Simple text response from the LLM</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create RAG context</span>
        <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_create_rag_context</span><span class="p">(</span>
            <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>

        <span class="c1"># Create OpenAI client</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">()</span>

        <span class="c1"># Get simple response from LLM</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">}</span>
            <span class="p">],</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span>
        <span class="p">)</span>

        <span class="n">answer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Simple LLM response generated for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...'"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to get simple LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Simple LLM query failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.consistency_check">
<code class="highlight language-python"><span class="n">consistency_check</span><span class="p">()</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.consistency_check" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Verify that your database collection is properly configured and ready to use.</p>
<p>Performs a comprehensive health check to ensure your collection's vector
dimensions, distance metrics, and other parameters match your embedding model.
This prevents subtle bugs that could cause poor search results or errors.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="bool">bool</span></code>
</td>
<td>
<div class="doc-md-description">
<p>True if everything is properly configured and ready for search operations.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="bool">bool</span></code>
</td>
<td>
<div class="doc-md-description">
<p>False indicates configuration mismatches that need attention.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">animals</span><span class="o">.</span><span class="n">consistency_check</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"✅ Collection is healthy and ready!"</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"your query here"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"❌ Configuration issues detected"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Consider recreating the collection:"</span><span class="p">)</span>
    <span class="n">animals</span><span class="o">.</span><span class="n">recreate_collection</span><span class="p">()</span>
</code></pre></div>
</details> <p>What's Checked:
    - Vector dimensions match between collection and embedder
    - Distance metric compatibility
    - Collection existence and accessibility
    - Basic connectivity to the vector database</p>
<details class="use-cases" open="">
<summary>Use Cases</summary>
<ul>
<li>Troubleshooting search performance issues</li>
<li>Validating setup after configuration changes</li>
<li>Health checks in production systems</li>
<li>Debugging after model or database updates</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">consistency_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Verify that your database collection is properly configured and ready to use.</span>

<span class="sd">    Performs a comprehensive health check to ensure your collection's vector</span>
<span class="sd">    dimensions, distance metrics, and other parameters match your embedding model.</span>
<span class="sd">    This prevents subtle bugs that could cause poor search results or errors.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if everything is properly configured and ready for search operations.</span>
<span class="sd">        False indicates configuration mismatches that need attention.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        if animals.consistency_check():</span>
<span class="sd">            print("✅ Collection is healthy and ready!")</span>
<span class="sd">            results = animals.search("your query here")</span>
<span class="sd">        else:</span>
<span class="sd">            print("❌ Configuration issues detected")</span>
<span class="sd">            print("Consider recreating the collection:")</span>
<span class="sd">            animals.recreate_collection()</span>
<span class="sd">        ```</span>

<span class="sd">    What's Checked:</span>
<span class="sd">        - Vector dimensions match between collection and embedder</span>
<span class="sd">        - Distance metric compatibility</span>
<span class="sd">        - Collection existence and accessibility</span>
<span class="sd">        - Basic connectivity to the vector database</span>

<span class="sd">    Use Cases:</span>
<span class="sd">        - Troubleshooting search performance issues</span>
<span class="sd">        - Validating setup after configuration changes</span>
<span class="sd">        - Health checks in production systems</span>
<span class="sd">        - Debugging after model or database updates</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">consistency_check</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.create_rag_context">
<code class="highlight language-python"><span class="n">create_rag_context</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">search_results</span><span class="p">,</span> <span class="n">system_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.create_rag_context" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Create a complete RAG context with system prompt and formatted results.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The user's question</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>search_results</code>
</td>
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Search results from animals.search()</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>system_prompt</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>System prompt to use (defaults to comprehensive prompt)</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Complete RAG context string</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Search results must be a list"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_rag_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">search_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                          <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Create a complete RAG context with system prompt and formatted results.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_query: The user's question</span>
<span class="sd">            search_results: Search results from animals.search()</span>
<span class="sd">            system_prompt: System prompt to use (defaults to comprehensive prompt)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete RAG context string</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">system_prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">system_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANIMALS_RAG_SYSTEM_PROMPT</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">system_prompt</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"System prompt must be a non-empty string"</span><span class="p">)</span>

        <span class="n">formatted_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_search_results_for_rag</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""</span>
<span class="si">{</span><span class="n">system_prompt</span><span class="si">}</span>

<span class="s2">## User Query</span>
<span class="si">{</span><span class="n">user_query</span><span class="si">}</span>

<span class="s2">## Relevant Quotes</span>
<span class="si">{</span><span class="n">formatted_results</span><span class="si">}</span>

<span class="s2">Please answer the user's question using the provided quotes and following the guidelines above.</span>
<span class="s2">"""</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.display_llm_response">
<code class="highlight language-python"><span class="n">display_llm_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">user_query</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.display_llm_response" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Display the LLM response in a formatted way using rich.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>response</code>
</td>
<td>
<code><a class="autorefs autorefs-internal" href="#rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse" title="AnimalWisdomResponse (rag_to_riches.corpus.animals.Animals.AnimalWisdomResponse)">AnimalWisdomResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The structured response from the LLM</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The original user query</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display_llm_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">AnimalWisdomResponse</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Display the LLM response in a formatted way using rich.</span>

<span class="sd">    Args:</span>
<span class="sd">        response: The structured response from the LLM</span>
<span class="sd">        user_query: The original user query</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.columns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Columns</span>

        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

        <span class="c1"># Display the main answer</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
            <span class="n">Text</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">answer</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"white"</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"🤖 LLM Answer to: '</span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span><span class="s2">'"</span><span class="p">,</span>
            <span class="n">border_style</span><span class="o">=</span><span class="s2">"green"</span>
        <span class="p">))</span>

        <span class="c1"># Display key insights</span>
        <span class="n">insights_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"• </span><span class="si">{</span><span class="n">insight</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">insight</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">key_insights</span><span class="p">])</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
            <span class="n">Text</span><span class="p">(</span><span class="n">insights_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">"💡 Key Insights"</span><span class="p">,</span>
            <span class="n">border_style</span><span class="o">=</span><span class="s2">"blue"</span>
        <span class="p">))</span>

        <span class="c1"># Display recommended quotes</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">:</span>
            <span class="n">quotes_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"💬 </span><span class="si">{</span><span class="n">quote</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">recommended_quotes</span><span class="p">])</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                <span class="n">Text</span><span class="p">(</span><span class="n">quotes_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">"📚 Recommended Quotes"</span><span class="p">,</span>
                <span class="n">border_style</span><span class="o">=</span><span class="s2">"yellow"</span>
            <span class="p">))</span>

        <span class="c1"># Display follow-up questions</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">:</span>
            <span class="n">questions_text</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">"❓ </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_up_questions</span><span class="p">])</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span>
                <span class="n">Text</span><span class="p">(</span><span class="n">questions_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">"🔍 Follow-up Questions"</span><span class="p">,</span>
                <span class="n">border_style</span><span class="o">=</span><span class="s2">"magenta"</span>
            <span class="p">))</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># Fallback to simple print if rich is not available</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Rich library not available, falling back to simple display"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_llm_response_simple</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">user_query</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to display LLM response: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_llm_response_simple</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">user_query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.display_search_results">
<code class="highlight language-python"><span class="n">display_search_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">search_description</span><span class="p">,</span> <span class="n">max_text_length</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.display_search_results" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Present search results in a beautiful, easy-to-read table format.</p>
<p>Creates an elegant visual display of your search results using the Rich library
for colorful, well-formatted output. Perfect for interactive applications,
demos, or any time you want to show results in a professional way.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>results</code>
</td>
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Your search results from the search() method. Each result
contains the quote text, author, category, and relevance score.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>search_description</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>A descriptive title for the search that will be
displayed at the top of the table (e.g., "Quotes about loyalty").</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>max_text_length</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum characters to display for each quote before
truncating with "..." (default: 120). Keeps table readable.</p>
</div>
</td>
<td>
<code>120</code>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Search and display results beautifully</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"courage and bravery"</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">display_search_results</span><span class="p">(</span>
    <span class="n">results</span><span class="p">,</span> 
    <span class="s2">"Quotes about Courage and Bravery"</span><span class="p">,</span>
    <span class="n">max_text_length</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</code></pre></div>
</details>
<details class="output-features" open="">
<summary>Output Features</summary>
<ul>
<li>🎨 Color-coded columns for easy scanning</li>
<li>📊 Relevance scores prominently displayed</li>
<li>✂️ Smart text truncation to maintain readability</li>
<li>📱 Responsive layout that works in various terminal sizes</li>
<li>🚫 Graceful handling of empty results</li>
</ul>
</details>
<details class="fallback-behavior" open="">
<summary>Fallback Behavior</summary>
<p>If the Rich library isn't available, automatically falls back to
simple text output that works in any environment.</p>
</details>
<details class="use-cases" open="">
<summary>Use Cases</summary>
<ul>
<li>Interactive demos and presentations</li>
<li>Development and debugging sessions</li>
<li>Educational tools showing search capabilities</li>
<li>Command-line applications with rich output</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Results must be a list"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_description</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_description</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_description</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"Search description must be a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_text_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_text_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"Max text length must be a positive integer"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">display_search_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                          <span class="n">search_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                          <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Present search results in a beautiful, easy-to-read table format.</span>

<span class="sd">    Creates an elegant visual display of your search results using the Rich library</span>
<span class="sd">    for colorful, well-formatted output. Perfect for interactive applications,</span>
<span class="sd">    demos, or any time you want to show results in a professional way.</span>

<span class="sd">    Args:</span>
<span class="sd">        results: Your search results from the search() method. Each result</span>
<span class="sd">            contains the quote text, author, category, and relevance score.</span>
<span class="sd">        search_description: A descriptive title for the search that will be</span>
<span class="sd">            displayed at the top of the table (e.g., "Quotes about loyalty").</span>
<span class="sd">        max_text_length: Maximum characters to display for each quote before</span>
<span class="sd">            truncating with "..." (default: 120). Keeps table readable.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Search and display results beautifully</span>
<span class="sd">        results = animals.search("courage and bravery", limit=5)</span>
<span class="sd">        animals.display_search_results(</span>
<span class="sd">            results, </span>
<span class="sd">            "Quotes about Courage and Bravery",</span>
<span class="sd">            max_text_length=100</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">    Output Features:</span>
<span class="sd">        - 🎨 Color-coded columns for easy scanning</span>
<span class="sd">        - 📊 Relevance scores prominently displayed</span>
<span class="sd">        - ✂️ Smart text truncation to maintain readability</span>
<span class="sd">        - 📱 Responsive layout that works in various terminal sizes</span>
<span class="sd">        - 🚫 Graceful handling of empty results</span>

<span class="sd">    Fallback Behavior:</span>
<span class="sd">        If the Rich library isn't available, automatically falls back to</span>
<span class="sd">        simple text output that works in any environment.</span>

<span class="sd">    Use Cases:</span>
<span class="sd">        - Interactive demos and presentations</span>
<span class="sd">        - Development and debugging sessions</span>
<span class="sd">        - Educational tools showing search capabilities</span>
<span class="sd">        - Command-line applications with rich output</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>

        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

        <span class="c1"># Create table</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"🔍 </span><span class="si">{</span><span class="n">search_description</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">header_style</span><span class="o">=</span><span class="s2">"bold magenta"</span><span class="p">,</span>
            <span class="n">border_style</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Add significant vertical and horizontal padding</span>
        <span class="p">)</span>

        <span class="c1"># Add columns</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"center"</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Score"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"center"</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Quote"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bright_white"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Author"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bold bright_yellow"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Category"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"❌ No results found."</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Add rows</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span>

            <span class="c1"># Truncate long quotes for readability</span>
            <span class="n">display_content</span> <span class="o">=</span> <span class="p">(</span><span class="n">content</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_text_length</span> 
                             <span class="k">else</span> <span class="n">content</span><span class="p">[:</span><span class="n">max_text_length</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"..."</span><span class="p">)</span>

            <span class="c1"># Create styled text for quote</span>
            <span class="n">quote_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">display_content</span><span class="si">}</span><span class="s1">"'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">)</span>

            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">quote_text</span><span class="p">,</span>
                <span class="n">author</span><span class="p">,</span>
                <span class="n">category</span>
            <span class="p">)</span>

        <span class="c1"># Display table</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"📊 Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"bold green"</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># Fallback to simple print if rich is not available</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Rich library not available, falling back to simple display"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_search_results_simple</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">search_description</span><span class="p">,</span> <span class="n">max_text_length</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to display search results: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="c1"># Fallback to simple display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_search_results_simple</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">search_description</span><span class="p">,</span> <span class="n">max_text_length</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.format_search_results_for_rag">
<code class="highlight language-python"><span class="n">format_search_results_for_rag</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.format_search_results_for_rag" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Format search results from Animals class for RAG system prompt.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>search_results</code>
</td>
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of ScoredPoint objects from animals.search()</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>max_results</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of results to include</p>
</div>
</td>
<td>
<code>5</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Formatted string for RAG context</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">search_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Search results must be a list"</span><span class="p">)</span>
    <span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_results</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s2">"Max results must be a positive integer"</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_search_results_for_rag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">],</span> 
                                     <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Format search results from Animals class for RAG system prompt.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_results: List of ScoredPoint objects from animals.search()</span>
<span class="sd">            max_results: Maximum number of results to include</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted string for RAG context</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"No relevant quotes found for this query."</span>

        <span class="n">formatted_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_results</span><span class="p">[:</span><span class="n">max_results</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"author"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"category"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span>

            <span class="n">formatted_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"""</span>
<span class="s2">Quote </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: "</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">"</span>
<span class="s2">Author: </span><span class="si">{</span><span class="n">author</span><span class="si">}</span>
<span class="s2">Category: </span><span class="si">{</span><span class="n">category</span><span class="si">}</span>
<span class="s2">Relevance Score: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span>
<span class="s2">"""</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.get_collection_stats">
<code class="highlight language-python"><span class="n">get_collection_stats</span><span class="p">()</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.get_collection_stats" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Get comprehensive statistics and insights about your quote collection.</p>
<p>Provides a detailed overview of your collection's size, content diversity,
and database status. Perfect for monitoring, debugging, or presenting
collection metrics to users.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Dictionary containing detailed statistics:</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>collection_name: Name of your quote collection</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>collection_exists: Whether the database collection exists</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>point_count: Total quotes stored in the database</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>loaded_quotes: Number of quotes currently loaded in memory</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>categories: List of all unique quote categories (sorted)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>authors: List of all unique authors (sorted)</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="n">stats</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">get_collection_stats</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Collection: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'collection_name'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total quotes in database: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'point_count'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quotes loaded in memory: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'loaded_quotes'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Categories (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">'categories'</span><span class="p">])</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'categories'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Authors (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">'authors'</span><span class="p">])</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'authors'</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>

<span class="c1"># Check if ready for search</span>
<span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">'collection_exists'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">stats</span><span class="p">[</span><span class="s1">'point_count'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"✅ Ready for semantic search!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"❌ Need to load and index quotes first"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="use-cases" open="">
<summary>Use Cases</summary>
<ul>
<li>Verify successful data loading and indexing</li>
<li>Display collection overview in user interfaces</li>
<li>Debug database connectivity issues</li>
<li>Monitor collection growth over time</li>
<li>Validate data integrity after operations</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Get comprehensive statistics and insights about your quote collection.</span>

<span class="sd">    Provides a detailed overview of your collection's size, content diversity,</span>
<span class="sd">    and database status. Perfect for monitoring, debugging, or presenting</span>
<span class="sd">    collection metrics to users.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing detailed statistics:</span>
<span class="sd">        - collection_name: Name of your quote collection</span>
<span class="sd">        - collection_exists: Whether the database collection exists</span>
<span class="sd">        - point_count: Total quotes stored in the database</span>
<span class="sd">        - loaded_quotes: Number of quotes currently loaded in memory</span>
<span class="sd">        - categories: List of all unique quote categories (sorted)</span>
<span class="sd">        - authors: List of all unique authors (sorted)</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        stats = animals.get_collection_stats()</span>

<span class="sd">        print(f"Collection: {stats['collection_name']}")</span>
<span class="sd">        print(f"Total quotes in database: {stats['point_count']}")</span>
<span class="sd">        print(f"Quotes loaded in memory: {stats['loaded_quotes']}")</span>
<span class="sd">        print(f"Categories ({len(stats['categories'])}): {stats['categories']}")</span>
<span class="sd">        print(f"Authors ({len(stats['authors'])}): {stats['authors'][:5]}...")</span>

<span class="sd">        # Check if ready for search</span>
<span class="sd">        if stats['collection_exists'] and stats['point_count'] &gt; 0:</span>
<span class="sd">            print("✅ Ready for semantic search!")</span>
<span class="sd">        else:</span>
<span class="sd">            print("❌ Need to load and index quotes first")</span>
<span class="sd">        ```</span>

<span class="sd">    Use Cases:</span>
<span class="sd">        - Verify successful data loading and indexing</span>
<span class="sd">        - Display collection overview in user interfaces</span>
<span class="sd">        - Debug database connectivity issues</span>
<span class="sd">        - Monitor collection growth over time</span>
<span class="sd">        - Validate data integrity after operations</span>
<span class="sd">    """</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"collection_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span>
        <span class="s2">"collection_exists"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">),</span>
        <span class="s2">"point_count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"loaded_quotes"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"categories"</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">"authors"</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"collection_exists"</span><span class="p">]:</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"point_count"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">count_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"loaded_quotes"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_categories</span><span class="p">()</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"authors"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_authors</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.index_all_quotes">
<code class="highlight language-python"><span class="n">index_all_quotes</span><span class="p">()</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.index_all_quotes" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Transform all loaded quotes into searchable vector embeddings.</p>
<p>This method takes your loaded quotes and creates high-dimensional vector
representations that enable semantic search. The process uses advanced
sentence transformers to understand the meaning and context of each quote,
not just keyword matching.</p>
<p>The indexing process:
1. Extracts text content from each quote
2. Generates semantic embeddings using the configured model
3. Stores vectors in the database with rich metadata
4. Creates searchable points for instant retrieval</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of unique point IDs for each indexed quote. These IDs can be used</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>for direct retrieval, debugging, or managing specific quotes.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="rag_to_riches.exceptions.InvalidPointsError">InvalidPointsError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>When indexing fails due to embedding errors,
database issues, or missing quote data.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Load quotes first</span>
<span class="n">wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="s2">"quotes.jsonl"</span><span class="p">)</span>

<span class="c1"># Index for semantic search</span>
<span class="n">point_ids</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully indexed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">point_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes"</span><span class="p">)</span>

<span class="c1"># Now you can search semantically</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"loyalty and friendship"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="performance-notes" open="">
<summary>Performance Notes</summary>
<ul>
<li>Batch processing is used for efficiency with large collections</li>
<li>Indexing time scales with collection size and model complexity</li>
<li>Typical speed: ~100-500 quotes per second depending on hardware</li>
<li>GPU acceleration automatically used if available</li>
</ul>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>You must call load_from_jsonl() before indexing. The method will
fail gracefully if no quotes are loaded, providing clear error messages.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
         <span class="s2">"Animal wisdom must be loaded before indexing"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">index_all_quotes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Transform all loaded quotes into searchable vector embeddings.</span>

<span class="sd">    This method takes your loaded quotes and creates high-dimensional vector</span>
<span class="sd">    representations that enable semantic search. The process uses advanced</span>
<span class="sd">    sentence transformers to understand the meaning and context of each quote,</span>
<span class="sd">    not just keyword matching.</span>

<span class="sd">    The indexing process:</span>
<span class="sd">    1. Extracts text content from each quote</span>
<span class="sd">    2. Generates semantic embeddings using the configured model</span>
<span class="sd">    3. Stores vectors in the database with rich metadata</span>
<span class="sd">    4. Creates searchable points for instant retrieval</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of unique point IDs for each indexed quote. These IDs can be used</span>
<span class="sd">        for direct retrieval, debugging, or managing specific quotes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidPointsError: When indexing fails due to embedding errors,</span>
<span class="sd">            database issues, or missing quote data.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Load quotes first</span>
<span class="sd">        wisdom = animals.load_from_jsonl("quotes.jsonl")</span>

<span class="sd">        # Index for semantic search</span>
<span class="sd">        point_ids = animals.index_all_quotes()</span>
<span class="sd">        print(f"Successfully indexed {len(point_ids)} quotes")</span>

<span class="sd">        # Now you can search semantically</span>
<span class="sd">        results = animals.search("loyalty and friendship")</span>
<span class="sd">        ```</span>

<span class="sd">    Performance Notes:</span>
<span class="sd">        - Batch processing is used for efficiency with large collections</span>
<span class="sd">        - Indexing time scales with collection size and model complexity</span>
<span class="sd">        - Typical speed: ~100-500 quotes per second depending on hardware</span>
<span class="sd">        - GPU acceleration automatically used if available</span>

<span class="sd">    Note:</span>
<span class="sd">        You must call load_from_jsonl() before indexing. The method will</span>
<span class="sd">        fail gracefully if no quotes are loaded, providing clear error messages.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="s2">"No animal wisdom loaded. Call load_from_jsonl() first."</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Prepare texts and metadata for batch indexing</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">]</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">quote</span><span class="o">.</span><span class="n">to_payload</span><span class="p">()</span> <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">]</span>

        <span class="c1"># Use SemanticSearch's batch indexing capability</span>
        <span class="n">indexed_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">index_all_text</span><span class="p">(</span>
            <span class="n">texts</span><span class="o">=</span><span class="n">texts</span><span class="p">,</span>
            <span class="n">metadata_list</span><span class="o">=</span><span class="n">metadata_list</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully indexed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">indexed_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> animal quotes into collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indexed_ids</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to index animal quotes: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.index_single_quote">
<code class="highlight language-python"><span class="n">index_single_quote</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.index_single_quote" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Index a single animal quote.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>quote</code>
</td>
<td>
<code><a class="autorefs autorefs-internal" href="../AnimalQuote/#rag_to_riches.corpus.data_models.AnimalQuote" title="rag_to_riches.corpus.data_models.AnimalQuote">AnimalQuote</a></code>
</td>
<td>
<div class="doc-md-description">
<p>AnimalQuote instance to index.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Point ID of the indexed quote.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index_single_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quote</span><span class="p">:</span> <span class="n">AnimalQuote</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Index a single animal quote.</span>

<span class="sd">    Args:</span>
<span class="sd">        quote: AnimalQuote instance to index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point ID of the indexed quote.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">index_text</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">quote</span><span class="o">.</span><span class="n">to_payload</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.load_and_index">
<code class="highlight language-python"><span class="n">load_and_index</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.load_and_index" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>One-step solution: load quotes from file and make them instantly searchable.</p>
<p>This convenience method combines loading and indexing in a single call,
perfect for getting up and running quickly. It handles the complete
pipeline from raw JSONL file to searchable vector database.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>jsonl_path</code>
</td>
<td>
<code><span title="pathlib.Path">Path</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to your JSONL file containing animal quotes.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="../AnimalWisdom/#rag_to_riches.corpus.data_models.AnimalWisdom" title="rag_to_riches.corpus.data_models.AnimalWisdom">AnimalWisdom</a></code>
</td>
<td>
<div class="doc-md-description">
<p>A tuple containing:</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>AnimalWisdom: Your loaded and validated quote collection</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" href="../AnimalWisdom/#rag_to_riches.corpus.data_models.AnimalWisdom" title="rag_to_riches.corpus.data_models.AnimalWisdom">AnimalWisdom</a>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>List[str]: Point IDs for all indexed quotes</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Complete setup in one line</span>
<span class="n">wisdom</span><span class="p">,</span> <span class="n">point_ids</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_and_index</span><span class="p">(</span><span class="s2">"my_quotes.jsonl"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ready to search </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wisdom</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes!"</span><span class="p">)</span>

<span class="c1"># Immediately start searching</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"courage and bravery"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>This method is equivalent to calling load_from_jsonl() followed by
index_all_quotes(), but more convenient for common workflows.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">AnimalWisdom</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""One-step solution: load quotes from file and make them instantly searchable.</span>

<span class="sd">    This convenience method combines loading and indexing in a single call,</span>
<span class="sd">    perfect for getting up and running quickly. It handles the complete</span>
<span class="sd">    pipeline from raw JSONL file to searchable vector database.</span>

<span class="sd">    Args:</span>
<span class="sd">        jsonl_path: Path to your JSONL file containing animal quotes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - AnimalWisdom: Your loaded and validated quote collection</span>
<span class="sd">        - List[str]: Point IDs for all indexed quotes</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Complete setup in one line</span>
<span class="sd">        wisdom, point_ids = animals.load_and_index("my_quotes.jsonl")</span>

<span class="sd">        print(f"Ready to search {len(wisdom)} quotes!")</span>

<span class="sd">        # Immediately start searching</span>
<span class="sd">        results = animals.search("courage and bravery")</span>
<span class="sd">        ```</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is equivalent to calling load_from_jsonl() followed by</span>
<span class="sd">        index_all_quotes(), but more convenient for common workflows.</span>
<span class="sd">    """</span>
    <span class="n">wisdom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span>
    <span class="n">point_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wisdom</span><span class="p">,</span> <span class="n">point_ids</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.load_from_jsonl">
<code class="highlight language-python"><span class="n">load_from_jsonl</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.load_from_jsonl" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Load and validate animal quotes from a JSONL (JSON Lines) file.</p>
<p>Reads a file where each line contains a JSON object with quote data. The method
performs comprehensive validation, skips malformed entries with helpful warnings,
and returns a structured collection of quotes ready for indexing and search.</p>
<details class="expected-jsonl-format" open="">
<summary>Expected JSONL Format</summary>
<p>Each line should be a JSON object with these fields:
- "text": The actual quote content (required)
- "author": Who said or wrote the quote (required)<br/>
- "category": Thematic classification like "Wisdom", "Humor" (required)</p>
</details>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>jsonl_path</code>
</td>
<td>
<code><span title="pathlib.Path">Path</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to your JSONL file containing animal quotes.
Can be a string path or pathlib.Path object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="../AnimalWisdom/#rag_to_riches.corpus.data_models.AnimalWisdom" title="rag_to_riches.corpus.data_models.AnimalWisdom">AnimalWisdom</a></code>
</td>
<td>
<div class="doc-md-description">
<p>AnimalWisdom object containing all successfully loaded quotes with</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="../AnimalWisdom/#rag_to_riches.corpus.data_models.AnimalWisdom" title="rag_to_riches.corpus.data_models.AnimalWisdom">AnimalWisdom</a></code>
</td>
<td>
<div class="doc-md-description">
<p>convenient methods for filtering and analysis.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="FileNotFoundError">FileNotFoundError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>When the specified file doesn't exist at the given path.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="rag_to_riches.exceptions.InvalidPointsError">InvalidPointsError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>When no valid quotes are found in the file, indicating
format issues or empty content.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Load quotes from file</span>
<span class="n">quotes_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"data/animal_wisdom.jsonl"</span><span class="p">)</span>
<span class="n">wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="n">quotes_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wisdom</span><span class="p">)</span><span class="si">}</span><span class="s2"> quotes"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Categories: </span><span class="si">{</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_categories</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Authors: </span><span class="si">{</span><span class="n">wisdom</span><span class="o">.</span><span class="n">get_authors</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Access individual quotes</span>
<span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">wisdom</span><span class="o">.</span><span class="n">quotes</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">quote</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">" - </span><span class="si">{</span><span class="n">quote</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="file-format-example" open="">
<summary>File Format Example</summary>
<div class="highlight"><pre><span></span><code>{"text": "Dogs are not our whole life, but they make our lives whole.", "author": "Roger Caras", "category": "Pets and Companionship"}
{"text": "The greatness of a nation can be judged by the way its animals are treated.", "author": "Mahatma Gandhi", "category": "Ethics and Compassion"}
</code></pre></div>
</details>
<details class="note" open="">
<summary>Note</summary>
<ul>
<li>Empty lines in the file are automatically skipped</li>
<li>Malformed JSON lines generate warnings but don't stop the process</li>
<li>The loaded quotes are stored in self.wisdom for later use</li>
<li>All text fields are automatically stripped of whitespace</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)),</span>
         <span class="s2">"JSONL path must be a string or Path object"</span><span class="p">)</span>
<span class="nd">@ensure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">result</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">AnimalWisdom</span><span class="p">),</span>
        <span class="s2">"Must return an AnimalWisdom instance"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_from_jsonl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnimalWisdom</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load and validate animal quotes from a JSONL (JSON Lines) file.</span>

<span class="sd">    Reads a file where each line contains a JSON object with quote data. The method</span>
<span class="sd">    performs comprehensive validation, skips malformed entries with helpful warnings,</span>
<span class="sd">    and returns a structured collection of quotes ready for indexing and search.</span>

<span class="sd">    Expected JSONL Format:</span>
<span class="sd">        Each line should be a JSON object with these fields:</span>
<span class="sd">        - "text": The actual quote content (required)</span>
<span class="sd">        - "author": Who said or wrote the quote (required)  </span>
<span class="sd">        - "category": Thematic classification like "Wisdom", "Humor" (required)</span>

<span class="sd">    Args:</span>
<span class="sd">        jsonl_path: Path to your JSONL file containing animal quotes.</span>
<span class="sd">            Can be a string path or pathlib.Path object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AnimalWisdom object containing all successfully loaded quotes with</span>
<span class="sd">        convenient methods for filtering and analysis.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: When the specified file doesn't exist at the given path.</span>
<span class="sd">        InvalidPointsError: When no valid quotes are found in the file, indicating</span>
<span class="sd">            format issues or empty content.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Load quotes from file</span>
<span class="sd">        quotes_path = Path("data/animal_wisdom.jsonl")</span>
<span class="sd">        wisdom = animals.load_from_jsonl(quotes_path)</span>

<span class="sd">        print(f"Loaded {len(wisdom)} quotes")</span>
<span class="sd">        print(f"Categories: {wisdom.get_categories()}")</span>
<span class="sd">        print(f"Authors: {wisdom.get_authors()}")</span>

<span class="sd">        # Access individual quotes</span>
<span class="sd">        for quote in wisdom.quotes[:3]:</span>
<span class="sd">            print(f'"{quote.text}" - {quote.author}')</span>
<span class="sd">        ```</span>

<span class="sd">    File Format Example:</span>
<span class="sd">        ```</span>
<span class="sd">        {"text": "Dogs are not our whole life, but they make our lives whole.", "author": "Roger Caras", "category": "Pets and Companionship"}</span>
<span class="sd">        {"text": "The greatness of a nation can be judged by the way its animals are treated.", "author": "Mahatma Gandhi", "category": "Ethics and Compassion"}</span>
<span class="sd">        ```</span>

<span class="sd">    Note:</span>
<span class="sd">        - Empty lines in the file are automatically skipped</span>
<span class="sd">        - Malformed JSON lines generate warnings but don't stop the process</span>
<span class="sd">        - The loaded quotes are stored in self.wisdom for later use</span>
<span class="sd">        - All text fields are automatically stripped of whitespace</span>
<span class="sd">    """</span>
    <span class="n">jsonl_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"JSONL file not found: </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">quotes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Skip empty lines</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">quote</span> <span class="o">=</span> <span class="n">AnimalQuote</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">quotes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Skipped invalid line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">quotes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
                <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"No valid quotes found in </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="o">=</span> <span class="n">AnimalWisdom</span><span class="p">(</span><span class="n">quotes</span><span class="o">=</span><span class="n">quotes</span><span class="p">,</span> <span class="n">source_file</span><span class="o">=</span><span class="n">jsonl_path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">quotes</span><span class="p">)</span><span class="si">}</span><span class="s2"> animal quotes from </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to load animal quotes from </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.rag">
<code class="highlight language-python"><span class="n">rag</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">'gpt-4o'</span><span class="p">,</span> <span class="n">response_type</span><span class="o">=</span><span class="s1">'structured'</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.rag" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>🚀 Complete AI-powered question answering in one powerful method call.</p>
<p>This is your one-stop solution for getting intelligent answers about animals.
It automatically searches your quote collection, finds the most relevant content,
and generates comprehensive AI responses with full transparency into the process.</p>
<p>Perfect for building chatbots, educational tools, or research applications where
you need both the AI answer and access to the underlying source material.</p>
<p>The Complete RAG Pipeline:
1. 🔍 Semantic search finds relevant quotes from your collection
2. 📝 Context generation creates optimized prompts for the AI
3. 🤖 AI reasoning produces thoughtful, grounded responses
4. 📊 Full transparency with all intermediate results returned</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Your question about animals. Use natural, conversational
language like "How do animals show love?" or "What can pets teach
children about responsibility?"</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>limit</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Number of quotes to use as context (default: 5). More context
can improve answer quality but increases cost and response time.</p>
</div>
</td>
<td>
<code>5</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>score_threshold</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Minimum relevance score for quotes (0.0-1.0). Higher
values ensure only highly relevant quotes are used as context.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>author</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Limit context to quotes from this author only. Great for
exploring specific perspectives or philosophies.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>category</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Focus on quotes from this category only. Useful for domain-
specific questions like "Ethics" or "Pet Care".</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>model</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>OpenAI model for AI responses. "gpt-4o" gives the best quality,
"gpt-3.5-turbo" is faster and more economical.</p>
</div>
</td>
<td>
<code>'gpt-4o'</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>response_type</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Format of AI response:
- "structured": Rich AnimalWisdomResponse with insights and follow-ups
- "simple": Plain text response for basic use cases</p>
</div>
</td>
<td>
<code>'structured'</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Complete results dictionary containing:</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>llm_response: AI answer (structured object or simple string)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>search_results: List of relevant quotes found (with scores)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>rag_context: Full prompt sent to AI (for debugging/transparency)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>query_info: Metadata about the query and processing parameters</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="rag_to_riches.exceptions.InvalidPointsError">InvalidPointsError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>When any step fails (search, context generation,
or AI response). Error messages indicate which step failed.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Complete RAG in one call</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"What do animals teach us about unconditional love?"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">response_type</span><span class="o">=</span><span class="s2">"structured"</span>
<span class="p">)</span>

<span class="c1"># Access the AI response</span>
<span class="n">ai_answer</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"llm_response"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"AI Answer:"</span><span class="p">,</span> <span class="n">ai_answer</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>

<span class="c1"># See what quotes were used</span>
<span class="n">quotes_used</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"search_results"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Based on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">quotes_used</span><span class="p">)</span><span class="si">}</span><span class="s2"> relevant quotes"</span><span class="p">)</span>

<span class="c1"># Inspect the full context (for debugging)</span>
<span class="n">full_prompt</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"rag_context"</span><span class="p">]</span>

<span class="c1"># Get query metadata</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"query_info"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Model: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'model'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Results: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'results_count'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="advanced-usage" open="">
<summary>Advanced Usage</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Domain-specific question</span>
<span class="n">ethics_result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"How should humans treat wild animals?"</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">"Ethics and Compassion"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="c1"># Author-focused inquiry</span>
<span class="n">gandhi_result</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">rag</span><span class="p">(</span>
    <span class="s2">"What did Gandhi believe about animals?"</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">"Mahatma Gandhi"</span><span class="p">,</span>
    <span class="n">response_type</span><span class="o">=</span><span class="s2">"simple"</span>
<span class="p">)</span>
</code></pre></div>
</details>
<details class="use-cases" open="">
<summary>Use Cases</summary>
<ul>
<li>Educational Q&amp;A systems about animals and nature</li>
<li>Research tools for exploring animal-human relationships</li>
<li>Content generation for blogs, articles, or presentations</li>
<li>Interactive chatbots with grounded, source-backed responses</li>
<li>Philosophical exploration of animal wisdom and ethics</li>
</ul>
</details>
<details class="performance-tips" open="">
<summary>Performance Tips</summary>
<ul>
<li>Start with limit=5 for good balance of quality and speed</li>
<li>Use score_threshold=0.7+ for highly focused questions</li>
<li>Choose "simple" response_type for faster, lower-cost interactions</li>
<li>Cache results for frequently asked questions</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
        <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"gpt-4o"</span><span class="p">,</span>
        <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"structured"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""🚀 Complete AI-powered question answering in one powerful method call.</span>

<span class="sd">    This is your one-stop solution for getting intelligent answers about animals.</span>
<span class="sd">    It automatically searches your quote collection, finds the most relevant content,</span>
<span class="sd">    and generates comprehensive AI responses with full transparency into the process.</span>

<span class="sd">    Perfect for building chatbots, educational tools, or research applications where</span>
<span class="sd">    you need both the AI answer and access to the underlying source material.</span>

<span class="sd">    The Complete RAG Pipeline:</span>
<span class="sd">    1. 🔍 Semantic search finds relevant quotes from your collection</span>
<span class="sd">    2. 📝 Context generation creates optimized prompts for the AI</span>
<span class="sd">    3. 🤖 AI reasoning produces thoughtful, grounded responses</span>
<span class="sd">    4. 📊 Full transparency with all intermediate results returned</span>

<span class="sd">    Args:</span>
<span class="sd">        user_query: Your question about animals. Use natural, conversational</span>
<span class="sd">            language like "How do animals show love?" or "What can pets teach</span>
<span class="sd">            children about responsibility?"</span>
<span class="sd">        limit: Number of quotes to use as context (default: 5). More context</span>
<span class="sd">            can improve answer quality but increases cost and response time.</span>
<span class="sd">        score_threshold: Minimum relevance score for quotes (0.0-1.0). Higher</span>
<span class="sd">            values ensure only highly relevant quotes are used as context.</span>
<span class="sd">        author: Limit context to quotes from this author only. Great for</span>
<span class="sd">            exploring specific perspectives or philosophies.</span>
<span class="sd">        category: Focus on quotes from this category only. Useful for domain-</span>
<span class="sd">            specific questions like "Ethics" or "Pet Care".</span>
<span class="sd">        model: OpenAI model for AI responses. "gpt-4o" gives the best quality,</span>
<span class="sd">            "gpt-3.5-turbo" is faster and more economical.</span>
<span class="sd">        response_type: Format of AI response:</span>
<span class="sd">            - "structured": Rich AnimalWisdomResponse with insights and follow-ups</span>
<span class="sd">            - "simple": Plain text response for basic use cases</span>

<span class="sd">    Returns:</span>
<span class="sd">        Complete results dictionary containing:</span>
<span class="sd">        - llm_response: AI answer (structured object or simple string)</span>
<span class="sd">        - search_results: List of relevant quotes found (with scores)</span>
<span class="sd">        - rag_context: Full prompt sent to AI (for debugging/transparency)</span>
<span class="sd">        - query_info: Metadata about the query and processing parameters</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidPointsError: When any step fails (search, context generation,</span>
<span class="sd">            or AI response). Error messages indicate which step failed.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Complete RAG in one call</span>
<span class="sd">        result = animals.rag(</span>
<span class="sd">            "What do animals teach us about unconditional love?",</span>
<span class="sd">            limit=7,</span>
<span class="sd">            score_threshold=0.6,</span>
<span class="sd">            response_type="structured"</span>
<span class="sd">        )</span>

<span class="sd">        # Access the AI response</span>
<span class="sd">        ai_answer = result["llm_response"]</span>
<span class="sd">        print("AI Answer:", ai_answer.answer)</span>

<span class="sd">        # See what quotes were used</span>
<span class="sd">        quotes_used = result["search_results"]</span>
<span class="sd">        print(f"Based on {len(quotes_used)} relevant quotes")</span>

<span class="sd">        # Inspect the full context (for debugging)</span>
<span class="sd">        full_prompt = result["rag_context"]</span>

<span class="sd">        # Get query metadata</span>
<span class="sd">        info = result["query_info"]</span>
<span class="sd">        print(f"Model: {info['model']}, Results: {info['results_count']}")</span>
<span class="sd">        ```</span>

<span class="sd">    Advanced Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Domain-specific question</span>
<span class="sd">        ethics_result = animals.rag(</span>
<span class="sd">            "How should humans treat wild animals?",</span>
<span class="sd">            category="Ethics and Compassion",</span>
<span class="sd">            limit=10</span>
<span class="sd">        )</span>

<span class="sd">        # Author-focused inquiry</span>
<span class="sd">        gandhi_result = animals.rag(</span>
<span class="sd">            "What did Gandhi believe about animals?",</span>
<span class="sd">            author="Mahatma Gandhi",</span>
<span class="sd">            response_type="simple"</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">    Use Cases:</span>
<span class="sd">        - Educational Q&amp;A systems about animals and nature</span>
<span class="sd">        - Research tools for exploring animal-human relationships</span>
<span class="sd">        - Content generation for blogs, articles, or presentations</span>
<span class="sd">        - Interactive chatbots with grounded, source-backed responses</span>
<span class="sd">        - Philosophical exploration of animal wisdom and ethics</span>

<span class="sd">    Performance Tips:</span>
<span class="sd">        - Start with limit=5 for good balance of quality and speed</span>
<span class="sd">        - Use score_threshold=0.7+ for highly focused questions</span>
<span class="sd">        - Choose "simple" response_type for faster, lower-cost interactions</span>
<span class="sd">        - Cache results for frequently asked questions</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Step 1: Perform semantic search</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

        <span class="c1"># Step 2: Generate RAG context</span>
        <span class="n">rag_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rag_context</span><span class="p">(</span>
            <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
            <span class="n">search_results</span><span class="o">=</span><span class="n">search_results</span>
        <span class="p">)</span>

        <span class="c1"># Step 3: Get LLM response based on type</span>
        <span class="k">if</span> <span class="n">response_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"structured"</span><span class="p">:</span>
            <span class="n">llm_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_llm</span><span class="p">(</span>
                <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">response_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"simple"</span><span class="p">:</span>
            <span class="n">llm_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_llm_simple</span><span class="p">(</span>
                <span class="n">user_query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid response_type: </span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2">. Must be 'structured' or 'simple'"</span><span class="p">)</span>

        <span class="c1"># Step 4: Prepare query info</span>
        <span class="n">query_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"user_query"</span><span class="p">:</span> <span class="n">user_query</span><span class="p">,</span>
            <span class="s2">"limit"</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
            <span class="s2">"score_threshold"</span><span class="p">:</span> <span class="n">score_threshold</span><span class="p">,</span>
            <span class="s2">"author_filter"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
            <span class="s2">"category_filter"</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
            <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
            <span class="s2">"response_type"</span><span class="p">:</span> <span class="n">response_type</span><span class="p">,</span>
            <span class="s2">"results_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Step 5: Return complete RAG result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"llm_response"</span><span class="p">:</span> <span class="n">llm_response</span><span class="p">,</span>
            <span class="s2">"search_results"</span><span class="p">:</span> <span class="n">search_results</span><span class="p">,</span>
            <span class="s2">"rag_context"</span><span class="p">:</span> <span class="n">rag_context</span><span class="p">,</span>
            <span class="s2">"query_info"</span><span class="p">:</span> <span class="n">query_info</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Complete RAG pipeline executed for query: '</span><span class="si">{</span><span class="n">user_query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...' "</span>
                   <span class="sa">f</span><span class="s2">"with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results and </span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2"> response"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"RAG pipeline failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"RAG pipeline failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.recreate_collection">
<code class="highlight language-python"><span class="n">recreate_collection</span><span class="p">()</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.recreate_collection" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Completely reset your quote collection with a fresh, empty database.</p>
<p>This is a powerful cleanup method that removes all existing quotes and
creates a brand new collection. Use this when you need to start over,
fix corruption issues, or completely change your quote dataset.</p>
<p>What this method does:
1. Safely deletes the existing collection if it exists
2. Creates a new empty collection with optimal settings
3. Clears all loaded quote data from memory
4. Prepares the system for fresh data loading</p>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="rag_to_riches.exceptions.InvalidPointsError">InvalidPointsError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the recreation process fails due to database
connection issues or permission problems.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Reset everything and start fresh</span>
<span class="n">animals</span><span class="o">.</span><span class="n">recreate_collection</span><span class="p">()</span>

<span class="c1"># Now load new data</span>
<span class="n">new_wisdom</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">load_from_jsonl</span><span class="p">(</span><span class="s2">"updated_quotes.jsonl"</span><span class="p">)</span>
<span class="n">animals</span><span class="o">.</span><span class="n">index_all_quotes</span><span class="p">()</span>
</code></pre></div>
</details>
<details class="warning" open="">
<summary>Warning</summary>
<p>This operation is irreversible! All existing quotes in the collection
will be permanently deleted. Make sure you have backups of important
data before calling this method.</p>
</details>
<details class="use-cases" open="">
<summary>Use Cases</summary>
<ul>
<li>Switching to a completely different quote dataset</li>
<li>Fixing corrupted vector data</li>
<li>Changing embedding models (requires reindexing)</li>
<li>Cleaning up test data before production deployment</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">recreate_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Completely reset your quote collection with a fresh, empty database.</span>

<span class="sd">    This is a powerful cleanup method that removes all existing quotes and</span>
<span class="sd">    creates a brand new collection. Use this when you need to start over,</span>
<span class="sd">    fix corruption issues, or completely change your quote dataset.</span>

<span class="sd">    What this method does:</span>
<span class="sd">    1. Safely deletes the existing collection if it exists</span>
<span class="sd">    2. Creates a new empty collection with optimal settings</span>
<span class="sd">    3. Clears all loaded quote data from memory</span>
<span class="sd">    4. Prepares the system for fresh data loading</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidPointsError: If the recreation process fails due to database</span>
<span class="sd">            connection issues or permission problems.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Reset everything and start fresh</span>
<span class="sd">        animals.recreate_collection()</span>

<span class="sd">        # Now load new data</span>
<span class="sd">        new_wisdom = animals.load_from_jsonl("updated_quotes.jsonl")</span>
<span class="sd">        animals.index_all_quotes()</span>
<span class="sd">        ```</span>

<span class="sd">    Warning:</span>
<span class="sd">        This operation is irreversible! All existing quotes in the collection</span>
<span class="sd">        will be permanently deleted. Make sure you have backups of important</span>
<span class="sd">        data before calling this method.</span>

<span class="sd">    Use Cases:</span>
<span class="sd">        - Switching to a completely different quote dataset</span>
<span class="sd">        - Fixing corrupted vector data</span>
<span class="sd">        - Changing embedding models (requires reindexing)</span>
<span class="sd">        - Cleaning up test data before production deployment</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Delete existing collection if it exists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Deleting existing collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>

        <span class="c1"># Create new empty collection</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Creating new empty collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="n">vector_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_vector_size</span><span class="p">(),</span>
            <span class="n">distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_distance_metric</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Clear loaded wisdom data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wisdom</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully recreated empty collection '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to recreate collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.search">
<code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.search" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Find the most relevant animal quotes using intelligent semantic search.</p>
<p>This powerful search method goes beyond simple keyword matching to understand
the meaning and context of your query. It finds quotes that are conceptually
similar, even if they don't share exact words with your search terms.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Your search question or topic. Use natural language like
"what do animals teach us about love?" or "quotes about courage".</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>limit</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of results to return (default: 10).
Higher values give more options but may include less relevant results.</p>
</div>
</td>
<td>
<code>10</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>score_threshold</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Minimum similarity score (0.0-1.0). Only quotes with
similarity above this threshold will be returned. Use 0.7+ for
highly relevant results, 0.5+ for broader matches.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>author</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Filter results to only include quotes by this specific author.
Case-insensitive matching (e.g., "Gandhi" matches "Mahatma Gandhi").</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>category</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Filter results to only include quotes from this category.
Case-insensitive matching (e.g., "wisdom" matches "Wisdom and Philosophy").</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of ScoredPoint objects, each containing:</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>score: Similarity score (higher = more relevant)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<ul>
<li>payload: Quote metadata (content, author, category)</li>
</ul>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Results are automatically sorted by relevance (highest scores first).</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="rag_to_riches.exceptions.InvalidPointsError">InvalidPointsError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>When search fails due to database issues or
invalid query parameters.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Basic semantic search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">"loyalty and friendship"</span><span class="p">)</span>

<span class="c1"># Precise search with high threshold</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"courage in difficult times"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>

<span class="c1"># Search within specific author's quotes</span>
<span class="n">gandhi_quotes</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"compassion"</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">"Mahatma Gandhi"</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="c1"># Browse by category</span>
<span class="n">wisdom_quotes</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="s2">"life lessons"</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">"Wisdom and Philosophy"</span>
<span class="p">)</span>

<span class="c1"># Process results</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Score: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quote: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Author: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"---"</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="search-tips" open="">
<summary>Search Tips</summary>
<ul>
<li>Use descriptive phrases rather than single keywords</li>
<li>Try different phrasings if you don't find what you're looking for</li>
<li>Lower the score_threshold to see more diverse results</li>
<li>Combine filters to narrow down to specific types of quotes</li>
</ul>
</details>
<details class="performance" open="">
<summary>Performance</summary>
<ul>
<li>Search is typically very fast (&lt; 100ms for most collections)</li>
<li>Larger collections may take slightly longer but remain responsive</li>
<li>Filtering by author/category happens after vector search for efficiency</li>
</ul>
</details>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"Query must be a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">author</span><span class="p">:</span> <span class="n">author</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
         <span class="s2">"Author filter must be None or a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">category</span><span class="p">:</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
         <span class="s2">"Category filter must be None or a non-empty string"</span><span class="p">)</span>
<span class="nd">@ensure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">result</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Must return a list"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
          <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Find the most relevant animal quotes using intelligent semantic search.</span>

<span class="sd">    This powerful search method goes beyond simple keyword matching to understand</span>
<span class="sd">    the meaning and context of your query. It finds quotes that are conceptually</span>
<span class="sd">    similar, even if they don't share exact words with your search terms.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Your search question or topic. Use natural language like</span>
<span class="sd">            "what do animals teach us about love?" or "quotes about courage".</span>
<span class="sd">        limit: Maximum number of results to return (default: 10).</span>
<span class="sd">            Higher values give more options but may include less relevant results.</span>
<span class="sd">        score_threshold: Minimum similarity score (0.0-1.0). Only quotes with</span>
<span class="sd">            similarity above this threshold will be returned. Use 0.7+ for</span>
<span class="sd">            highly relevant results, 0.5+ for broader matches.</span>
<span class="sd">        author: Filter results to only include quotes by this specific author.</span>
<span class="sd">            Case-insensitive matching (e.g., "Gandhi" matches "Mahatma Gandhi").</span>
<span class="sd">        category: Filter results to only include quotes from this category.</span>
<span class="sd">            Case-insensitive matching (e.g., "wisdom" matches "Wisdom and Philosophy").</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of ScoredPoint objects, each containing:</span>
<span class="sd">        - score: Similarity score (higher = more relevant)</span>
<span class="sd">        - payload: Quote metadata (content, author, category)</span>
<span class="sd">        Results are automatically sorted by relevance (highest scores first).</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidPointsError: When search fails due to database issues or</span>
<span class="sd">            invalid query parameters.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Basic semantic search</span>
<span class="sd">        results = animals.search("loyalty and friendship")</span>

<span class="sd">        # Precise search with high threshold</span>
<span class="sd">        results = animals.search(</span>
<span class="sd">            "courage in difficult times",</span>
<span class="sd">            limit=5,</span>
<span class="sd">            score_threshold=0.8</span>
<span class="sd">        )</span>

<span class="sd">        # Search within specific author's quotes</span>
<span class="sd">        gandhi_quotes = animals.search(</span>
<span class="sd">            "compassion",</span>
<span class="sd">            author="Mahatma Gandhi",</span>
<span class="sd">            limit=3</span>
<span class="sd">        )</span>

<span class="sd">        # Browse by category</span>
<span class="sd">        wisdom_quotes = animals.search(</span>
<span class="sd">            "life lessons",</span>
<span class="sd">            category="Wisdom and Philosophy"</span>
<span class="sd">        )</span>

<span class="sd">        # Process results</span>
<span class="sd">        for result in results:</span>
<span class="sd">            print(f"Score: {result.score:.3f}")</span>
<span class="sd">            print(f"Quote: {result.payload['content']}")</span>
<span class="sd">            print(f"Author: {result.payload['author']}")</span>
<span class="sd">            print("---")</span>
<span class="sd">        ```</span>

<span class="sd">    Search Tips:</span>
<span class="sd">        - Use descriptive phrases rather than single keywords</span>
<span class="sd">        - Try different phrasings if you don't find what you're looking for</span>
<span class="sd">        - Lower the score_threshold to see more diverse results</span>
<span class="sd">        - Combine filters to narrow down to specific types of quotes</span>

<span class="sd">    Performance:</span>
<span class="sd">        - Search is typically very fast (&lt; 100ms for most collections)</span>
<span class="sd">        - Larger collections may take slightly longer but remain responsive</span>
<span class="sd">        - Filtering by author/category happens after vector search for efficiency</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use SemanticSearch for the core search functionality</span>
        <span class="c1"># Request more results than needed to allow for filtering</span>
        <span class="n">search_limit</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">*</span> <span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">author</span> <span class="ow">or</span> <span class="n">category</span><span class="p">)</span> <span class="k">else</span> <span class="n">limit</span>

        <span class="n">initial_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_search</span><span class="o">.</span><span class="n">search_with_text</span><span class="p">(</span>
            <span class="n">query_text</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">search_limit</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span>
        <span class="p">)</span>

        <span class="c1"># Apply metadata filters if specified</span>
        <span class="n">filtered_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_metadata_filters</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">initial_results</span><span class="p">,</span>
            <span class="n">author_filter</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="n">category_filter</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

        <span class="c1"># Limit to requested number of results</span>
        <span class="n">final_results</span> <span class="o">=</span> <span class="n">filtered_results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Animal quotes search for '</span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...' returned </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results"</span>
                   <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">' (filtered by author)'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="s2">"</span>
                   <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">' (filtered by category)'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final_results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidPointsError</span><span class="p">(</span>
            <span class="n">issue</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Failed to search animal quotes: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">points_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="rag_to_riches.corpus.animals.Animals.search_and_create_rag_context">
<code class="highlight language-python"><span class="n">search_and_create_rag_context</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">system_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#rag_to_riches.corpus.animals.Animals.search_and_create_rag_context" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Search for quotes and create RAG context in one convenient method.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>user_query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The user's question</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>limit</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of search results to include</p>
</div>
</td>
<td>
<code>5</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>score_threshold</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Minimum similarity score threshold</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>author</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional filter to only return quotes by this author</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>category</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional filter to only return quotes in this category</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>system_prompt</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>System prompt to use (defaults to comprehensive prompt)</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Complete RAG context string</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/rag_to_riches/corpus/animals.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">"User query must be a non-empty string"</span><span class="p">)</span>
<span class="nd">@require</span><span class="p">(</span><span class="k">lambda</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Limit must be a positive integer"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_and_create_rag_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                                <span class="n">score_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Search for quotes and create RAG context in one convenient method.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_query: The user's question</span>
<span class="sd">        limit: Maximum number of search results to include</span>
<span class="sd">        score_threshold: Minimum similarity score threshold</span>
<span class="sd">        author: Optional filter to only return quotes by this author</span>
<span class="sd">        category: Optional filter to only return quotes in this category</span>
<span class="sd">        system_prompt: System prompt to use (defaults to comprehensive prompt)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Complete RAG context string</span>
<span class="sd">    """</span>
    <span class="c1"># Search for relevant quotes</span>
    <span class="n">search_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="n">user_query</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="n">category</span>
    <span class="p">)</span>

    <span class="c1"># Create RAG context</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rag_context</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">search_results</span><span class="p">,</span> <span class="n">system_prompt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><hr/>
<p><em>The Animals class represents the culmination of modern RAG system design - combining semantic search, AI reasoning, and beautiful presentation into a single, powerful interface. Perfect for building production-ready applications that need intelligent, grounded responses about animal wisdom and knowledge.</em> </p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>